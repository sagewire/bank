<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <script src="/js/jquery.min.js"></script>
        <title>jsPlumb Toolkit - documentation</title>
        <link href="//fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="../css/main.css" rel="stylesheet">



        <link rel="stylesheet" href="../css/jsplumb-doc.css">
        <script src="/js/docs.js"></script>
    </head>

    <body>

        <!-- Fixed navbar -->
<div class="navbar navbar-top navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="../index.html"><img src="../img/logo-medium-jsplumb.png"></a>

        </div>

        <div class="navbar-collapse collapse nav-wrapper">
            <ul class="nav navbar-nav">
                <li><a href="../index.html#demos">DEMOS</a></li>
<li><a href="../doc/home.html">DOCS</a></li>
<li><a href="../apidocs/index.html">APIDOCS</a></li>

            </ul>

            <div class="social-nav hidden-xs">
                <!--a href="#" class="link"><span class="icon-facebook"></span></a-->
<a href="http://twitter.com/jsplumblib" class="link"><span class="icon-twitter"></span></a>
<a href="http://github.com/sporritt/jsplumb/" class="link"><span class="icon-github"></span></a>
<a href="http://www.linkedin.com/company/jsplumb" class="link"><span class="icon-linkedin"></span></a>

            </div>
        </div><!--/.nav-collapse -->
    </div>
</div>


        <div class="container padding-top">
            <div class="row" id="docs">
                <div class="docs-nav col-xs-3" tabindex="0">
                    <ul>
<li><a href="home.html">Home</a></li>
<li><a href="getting-started.html">Getting Started</a></li>
<li><a href="basic-concepts.html">Basic Concepts</a>
    <ul>
        <li><a href="basic-concepts.html#instantiating">Instantiating the Toolkit</a></li>
        <li><a href="basic-concepts.html#basicloading">Loading Data</a></li>
        <li><a href="basic-concepts.html#rendering">Rendering</a></li>
    </ul>
</li>  
<li><a href="data-model.html">Data Model</a>
    <ul>
        <li><a href="data-model.html#format">Data Format</a></li>
        <li><a href="data-model.html#node-edge-port-id">Node, Edge and Port IDs</a></li>
        <li><a href="data-model.html#node-edge-port-type">Node, Edge and Port Type</a></li>
        <li><a href="data-model.html#datafactories">Data Factories</a></li>
    </ul>
</li>  
<li><a href="rendering.html">Rendering</a>
<ul>
    <li><a href="models-and-views.html">Models and Views</a></li>
    <li><a href="templating.html">Templating</a></li>
    <li><a href="layouts.html">Layouts</a></li>
    <li><a href="ui-states.html">UI States</a></li>
    <li><a href="path-tracing.html">Path Tracing</a></li>
    <li><a href="rendering.html#dragpalette">Drag & Drop Nodes</a></li>
    <li><a href="navigation.html">Navigating your Dataset</a></li>
</ul>
</li>
<li>
Data Management
    <ul>
        <li><a href="loading-and-saving-data.html">Loading & Saving Data</a></li>
        <li><a href="loading-and-saving-data.html#loading">Loading</a></li>
        <li><a href="updating-data.html">Updating Data</a></li>
    </ul>
</li>
    
<li><a href="css.html">CSS</a>
    <ul>
        <li><a href="css.html#defaultcss">Default CSS Stylesheet</a></li>
        <li><a href="css.html#ref">Class Reference</a></li>
    </ul>
</li>
  
<li><a href="events.html">Events</a>
    <ul>
        <li><a href="events.html#toolkit">Toolkit Events</a></li>
        <li><a href="events.html#surface">Rendering Events</a></li>
    </ul>
</li>
  
<li>Selecting Content
    <ul>
      <li><a href="selections.html">Selections</a></li>
      <li><a href="paths.html">Paths</a></li>
      <li><a href="filters.html">Filters</a></li>
    </ul>
</li>

<li><a href="angular-integration.html">Angular Integration</a></li>
<li>Demonstrations
    <ul>
      <li><a href="demo-hierarchical.html">Hierarchical Layout</a></li>
      <li><a href="demo-spring.html">Spring Layout</a></li>
      <li><a href="demo-imageWidget.html">Image Widget</a></li>
      <li><a href="demo-circular.html">Circular Layout</a></li>
      <li><a href="demo-multiple.html">Multiple Renderers</a></li>
      <li><a href="demo-paths.html">Path Tracing</a></li>
      <li><a href="demo-absolute.html">Absolute Layout</a></li>
      <li><a href="demo-database-visualizer.html">Database Visualizer</a></li>
      <li><a href="demo-flowchart-builder.html">Flowchart Builder</a></li>
      <li><a href="demo-angular.html">Angular Integration</a></li>
      <li><a href="demo-hello-world.html">Hello World</a></li>
    </ul>
</li>
    
<li><a href="UtilityFunctions.html">Utilities</a></li>
<li><a href="dialogs.html">Dialogs</a></li>
<li><a href="drawing.html">Drawing</a></li>
</ul>
                </div>
                <div class="markdown-body col-xs-9">
                    <h2>Flowchart Builder</h2>

<p>This is a port of the Flowchart Builder application that demonstrates the Toolkit&#39;s Angular integration.</p>

<p><img src="demo-flowchart.png" alt="Flowchart Builder Demonstration"></p>

<p>This page gives you an in-depth look at how the application is put together.</p>

<ul>
<li><a href="#setup">Page Setup</a></li>
<li><a href="#templates">Templates</a></li>
<li><a href="#directives">Directive Configuration</a></li>
<li><a href="#initialisation">Initialisation</a></li>
<li><a href="#loading">Data Loading</a></li>
<li><a href="#behaviour">Behaviour</a></li>
<li><a href="#resizedrag">Resizing/Dragging Nodes</a></li>
<li><a href="#selecting">Selecting Nodes</a></li>
<li><a href="#dialogs">Dialogs</a></li>
<li><a href="#dragging">Dragging New Nodes</a></li>
</ul>

<p><a id="setup"></a></p>

<h3>Page Setup</h3>

<h6>CSS</h6>

<ul>
<li><strong>Font Awesome 4.0.3</strong> Used for all the iconography. Not a Toolkit requirement.</li>
<li><strong>jsPlumbToolkit-defaults.css</strong> Recommended for all apps using the Toolkit, at least when you first start to build your app. This stylesheet contains sane defaults for the various widgets in the Toolkit.</li>
<li><strong>jsPlumbToolkit-demo.css</strong> Common styles for the demonstration pages. Not a Toolkit requirement.</li>
<li><strong>app.css</strong> Styles specific to this demo. </li>
</ul>

<h6>JS</h6>

<ul>
<li><strong>angular.js</strong> We use version 1.4.5 in this demonstration.</li>
<li><strong>jsPlumb-x.x.x.js</strong></li>
<li><strong>jsPlumbToolkit-x.x.x.js</strong></li>
<li><strong>app.js</strong> Application specific JS.</li>
</ul>

<hr>

<p><a id="templates"></a></p>

<h3>Templates</h3>

<p>There are four templates used by the app - one each for the node types of <code>Question</code>, <code>Action</code> and <code>Output</code>, and one 
for the <code>Start</code> node. These are inlined in <code>index.html</code>.</p>

<p>The templates look like this:</p>

<p><strong>Start</strong></p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/ng-template&quot;</span> <span class="na">id=</span><span class="s">&quot;start_template.tpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">ng-attr-style=</span><span class="s">&quot;width:{{node.w}} px;height:{{node.h}} px;&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;position:relative&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{ node.w }} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{ node.h }} &quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;ellipse</span> <span class="na">ng-attr-cx=</span><span class="s">&quot;{{ node.w/2 }} &quot;</span> <span class="na">ng-attr-cy=</span><span class="s">&quot;{{ node.h/2 }} &quot;</span> <span class="na">ng-attr-rx=</span><span class="s">&quot;{{ node.w/2 }} &quot;</span> <span class="na">ng-attr-ry=</span><span class="s">&quot;{{ node.h/2 }} &quot;</span> <span class="na">class=</span><span class="s">&quot;outer&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;ellipse</span> <span class="na">ng-attr-cx=</span><span class="s">&quot;{{ node.w/2 }} &quot;</span> <span class="na">ng-attr-cy=</span><span class="s">&quot;{{ node.h/2 }} &quot;</span> <span class="na">ng-attr-rx=</span><span class="s">&quot;{{ (node.w/2) - 10 }} &quot;</span> <span class="na">ng-attr-ry=</span><span class="s">&quot;{{ (node.h/2) - 10 }} &quot;</span> <span class="na">class=</span><span class="s">&quot;inner&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;text</span> <span class="na">text-anchor=</span><span class="s">&quot;middle&quot;</span> <span class="na">ng-attr-x=</span><span class="s">&quot;{{ node.w / 2 }} &quot;</span> <span class="na">ng-attr-y=</span><span class="s">&quot;{{ node.h / 2 }} &quot;</span> <span class="na">dominant-baseline=</span><span class="s">&quot;central&quot;</span><span class="nt">&gt;</span>{{node.text}} <span class="nt">&lt;/text&gt;</span>
            <span class="nt">&lt;/svg&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;jtk-source</span> <span class="na">port-type=</span><span class="s">&quot;start&quot;</span> <span class="na">filter=</span><span class="s">&quot;.outer&quot;</span> <span class="na">filter-negate=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/jtk-source&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>The <strong>Start</strong> node consists of an ellipse with a text label centered inside of it. Note here - and in all the other 
templates in this demo - there are a few main differences between the format of this template and that of a template using
the Toolkit&#39; default templating mechanism:</p>

<ul>
<li>You do not need to prefix SVG elements with an <code>svg</code> namespace in Angular. </li>
<li>You must prefix SVG attributes if they contain an expression. There are numerous examples of this above: <code>ng-attr-cx</code>,
<code>ng-attr-cy</code> etc. This is how Angular handles the fact that SVG elements are unforgiving when an attribute does not have
a value that is in the correct format (due to the digest loop in Angular, values are not written when the template is
first rendered).</li>
<li>You must also prefix a <code>style</code> attribute, eg <code>ng-attr-style</code> instead of just <code>style</code>. This is just for IE compatibility;
other browsers allow you to specify <code>style</code>.</li>
<li>All references to the node data that is being rendered are prefixed with <code>node.</code>. For instance, the first line in the
template here is:</li>
</ul>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">ng-attr-stylestyle=</span><span class="s">&quot;width:{{node.w}} px;height:{{node.h}} px;&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>but in the version of this demo using the default templating mechanism it looks like this:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;width:${w}px;height:${h}px;&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<ul>
<li>Any <code>jtk-source</code>, <code>jtk-target</code> or <code>jtk-port</code> elements that are intended to configure the node&#39;s main container have to
be placed in the <em>root of the template</em>. This is in contrast to the default templating mechanism, which expects one
root element per template. It is due to the fact that the template is rendered by Angular inside of its directive element,
and the directive element is not discarded. There is a mechanism in Angular to instruct it to remove the original
directive element (<code>replace:true</code> in a directive), but this is deprecated and not recommended by Angular, and will not
work with the Toolkit integration.</li>
</ul>

<p>The <code>jtk-source</code> element declares that this node is an edge source, of type <code>start</code> (the <code>port-type</code> attribute 
specifies this).  The <code>filter</code> attribute instructs the Toolkit to enable drag only from some element that is not a 
child of an <code>svg</code> element, but then <code>filter-negate</code> is <code>true</code>: the result is that dragging will begin only from a 
descendant of the <code>svg</code> element. What this means visually is that the user will not be able to start a drag from the 
whitespace surrounding the ellipse.</p>

<p><strong>Action</strong></p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/ng-template&quot;</span> <span class="na">id=</span><span class="s">&quot;action_template.tpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">ng-attr-style=</span><span class="s">&quot;width:{{node.w}} px;height:{{node.h}} px;&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;position:relative&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-edit node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;editNode(node)&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-pencil-square-o&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-delete node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;removeNode(node)&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-times&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h}} &quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&quot;0&quot;</span> <span class="na">y=</span><span class="s">&quot;0&quot;</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h}} &quot;</span> <span class="na">class=</span><span class="s">&quot;outer&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&quot;10&quot;</span> <span class="na">y=</span><span class="s">&quot;10&quot;</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w-20}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h-20}} &quot;</span> <span class="na">class=</span><span class="s">&quot;inner&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;text</span> <span class="na">text-anchor=</span><span class="s">&quot;middle&quot;</span> <span class="na">ng-attr-x=</span><span class="s">&quot;{{node.w/2}} &quot;</span> <span class="na">ng-attr-y=</span><span class="s">&quot;{{node.h/2}} &quot;</span> <span class="na">dominant-baseline=</span><span class="s">&quot;central&quot;</span><span class="nt">&gt;</span>{{node.text}} <span class="nt">&lt;/text&gt;</span>
                <span class="nt">&lt;svg&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;jtk-target</span> <span class="na">port-type=</span><span class="s">&quot;target&quot;</span><span class="nt">&gt;&lt;/jtk-target&gt;</span>
        <span class="nt">&lt;jtk-source</span> <span class="na">port-type=</span><span class="s">&quot;source&quot;</span> <span class="na">filter=</span><span class="s">&quot;.outer&quot;</span><span class="nt">&gt;&lt;/jtk-source&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>Once again we use the position and dimensions for the node&#39;s main container as well as its SVG elements. <strong>Action</strong> 
nodes are configured as both edge sources and targets.</p>

<p><strong>Question</strong></p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/ng-template&quot;</span> <span class="na">id=</span><span class="s">&quot;question_template.tpl&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">ng-attr-style=</span><span class="s">&quot;width:{{node.w}} px;height:{{node.h}} px;&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-edit node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;editNode(node)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-pencil-square-o&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-delete node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;removeNode(node)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-times&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;svg</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h}} &quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;path</span> <span class="na">ng-attr-d=</span><span class="s">&quot;M {{node.w/2}}  0 L {{node.w}}  {{node.h/2}}  L {{node.w/2}}  {{node.h}}  L 0 {{node.h/2}}  Z&quot;</span> <span class="na">class=</span><span class="s">&quot;outer&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;path</span> <span class="na">ng-attr-d=</span><span class="s">&quot;M {{node.w/2}}  10 L {{node.w-10}}  {{node.h/2}}  L {{node.w/2}}  {{node.h-10}}  L 10 {{node.h/2}}  Z&quot;</span> <span class="na">class=</span><span class="s">&quot;inner&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;text</span> <span class="na">text-anchor=</span><span class="s">&quot;middle&quot;</span> <span class="na">ng-attr-x=</span><span class="s">&quot;{{node.w/2}} &quot;</span> <span class="na">ng-attr-y=</span><span class="s">&quot;{{node.h/2}} &quot;</span> <span class="na">dominant-baseline=</span><span class="s">&quot;central&quot;</span><span class="nt">&gt;</span>{{node.text}} <span class="nt">&lt;/text&gt;</span>
        <span class="nt">&lt;/svg&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;jtk-source</span> <span class="na">port-type=</span><span class="s">&quot;source&quot;</span> <span class="na">filter=</span><span class="s">&quot;.outer&quot;</span><span class="nt">&gt;&lt;/jtk-source&gt;</span>
    <span class="nt">&lt;jtk-target</span> <span class="na">port-type=</span><span class="s">&quot;target&quot;</span><span class="nt">&gt;&lt;/jtk-target&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>The <strong>Question</strong> node draws a diamond, and declares itself to be an edge target and source. </p>

<p><strong>Output</strong></p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"> <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/ng-template&quot;</span> <span class="na">id=</span><span class="s">&quot;output_template.tpl&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">ng-attr-style=</span><span class="s">&quot;width:{{node.w}} px;height:{{node.h}} px;&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;position:relative&quot;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-edit node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;editNode(node)&quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-pencil-square-o&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
             <span class="nt">&lt;/div&gt;</span>
             <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-delete node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;removeNode(node)&quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-times&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
             <span class="nt">&lt;/div&gt;</span>
             <span class="nt">&lt;svg</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h}} &quot;</span><span class="nt">&gt;</span>
                 <span class="nt">&lt;rect</span> <span class="na">x=</span><span class="s">&quot;0&quot;</span> <span class="na">y=</span><span class="s">&quot;0&quot;</span> <span class="na">ng-attr-width=</span><span class="s">&quot;{{node.w}} &quot;</span> <span class="na">ng-attr-height=</span><span class="s">&quot;{{node.h}} &quot;</span><span class="nt">/&gt;</span>
                 <span class="nt">&lt;text</span> <span class="na">text-anchor=</span><span class="s">&quot;middle&quot;</span> <span class="na">ng-attr-x=</span><span class="s">&quot;{{node.w/2}} &quot;</span> <span class="na">ng-attr-y=</span><span class="s">&quot;{{node.h/2}} &quot;</span> <span class="na">dominant-baseline=</span><span class="s">&quot;central&quot;</span><span class="nt">&gt;</span>{{node.text}} <span class="nt">&lt;/text&gt;</span>
             <span class="nt">&lt;/svg&gt;</span>
         <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;jtk-target</span> <span class="na">port-type=</span><span class="s">&quot;target&quot;</span><span class="nt">&gt;&lt;/jtk-target&gt;</span>
 <span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<p>The <code>Output</code> node is configured to be a connection target only.</p>

<hr>

<p><a name="directives"></a></p>

<h3>Directive Configuration</h3>

<p>Everything is contained within one element that declares the controller and app to use:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jtk-demo-main&quot;</span> <span class="na">id=</span><span class="s">&quot;jtk-demo-flowchart&quot;</span> <span class="na">ng-controller=</span><span class="s">&quot;DemoController as DemoController&quot;</span> <span class="na">ng-app=</span><span class="s">&quot;app&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>The demo uses three directives. Here we see how the Toolkit and its Miniview are declared:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;jsplumb-toolkit</span> <span class="na">params=</span><span class="s">&quot;DemoController.toolkitParams&quot;</span>
         <span class="na">init=</span><span class="s">&quot;DemoController.init&quot;</span>
         <span class="na">render-params=</span><span class="s">&quot;DemoController.renderParams&quot;</span>
         <span class="na">jtk-id=</span><span class="s">&quot;flowchartToolkit&quot;</span>
         <span class="na">surface-id=</span><span class="s">&quot;flowchartSurface&quot;</span>
         <span class="na">style=</span><span class="s">&quot;width:750px;height:600px;position:relative;margin-right: 20px;&quot;</span><span class="nt">&gt;</span>

    ...

    <span class="c">&lt;!-- miniview --&gt;</span>
    <span class="nt">&lt;jsplumb-miniview</span> <span class="na">surface-id=</span><span class="s">&quot;flowchartSurface&quot;</span> <span class="na">class=</span><span class="s">&quot;miniview&quot;</span><span class="nt">&gt;&lt;/jsplumb-miniview&gt;</span>

<span class="nt">&lt;/jsplumb-toolkit&gt;</span>
</code></pre></div>
<p>Points to note:</p>

<ul>
<li>Both <code>params</code> (for the Toolkit constructor) and <code>renderParams</code> (for the renderer) are provided.</li>
<li>An ID is assigned to the Toolkit and to the surface</li>
<li>An <code>init</code> method is declared; this will be executed after the Toolkit and Surface have been created.</li>
</ul>

<p>Here is how the palette (the set of nodes that can be dragged into the work area) is declared:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar node-palette&quot;</span> <span class="err">jsplumb-palette</span> <span class="na">selector=</span><span class="s">&quot;li&quot;</span> <span class="na">surface-id=</span><span class="s">&quot;flowchartSurface&quot;</span> <span class="na">type-extractor=</span><span class="s">&quot;DemoController.typeExtractor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">ng-repeat=</span><span class="s">&quot;node in nodeTypes&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li</span> <span class="na">jtk-node-type=</span><span class="s">&quot;{{ node.type }} &quot;</span> <span class="na">title=</span><span class="s">&quot;Drag to add new&quot;</span><span class="nt">&gt;</span>
            {{node.label}} 
        <span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Points to note:</p>

<ul>
<li><code>nodeTypes</code> is an object in the scope of <code>DemoController</code>.</li>
<li><code>surface-id</code> maps to the <code>surface-id</code> specified in the <code>jsplumb-toolkit</code> directive.</li>
<li>The <code>selector</code> attribute instructs the Palette to look for any <code>li</code> elements that are descendants of the Palette&#39;s element.</li>
<li>A <code>type-extractor</code> function is specified; this is what determines the type of newly dropped elements.</li>
</ul>

<p><a name="initialisation"></a></p>

<h3>Initialisation</h3>

<p><code>DemoController.init</code> looks like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">toolkit</span> <span class="o">=</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">toolkit</span><span class="p">;</span>

    <span class="nx">toolkit</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span><span class="s2">&quot;data/flowchart-1.json&quot;</span>
    <span class="p">});</span>

    <span class="c1">// -------------- configure buttons --------------------------------</span>

    <span class="kd">var</span> <span class="nx">controls</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.controls&quot;</span><span class="p">);</span>
    <span class="c1">// listener for mode change on renderer.</span>
    <span class="nx">scope</span><span class="p">.</span><span class="nx">surface</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;modeChanged&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">controls</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;[mode]&quot;</span><span class="p">),</span> <span class="s2">&quot;selected-mode&quot;</span><span class="p">);</span>
        <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">controls</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;[mode=&#39;&quot;</span> <span class="o">+</span> <span class="nx">mode</span> <span class="o">+</span> <span class="s2">&quot;&#39;]&quot;</span><span class="p">),</span> <span class="s2">&quot;selected-mode&quot;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// pan mode/select mode</span>
    <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">controls</span><span class="p">,</span> <span class="s2">&quot;tap&quot;</span><span class="p">,</span> <span class="s2">&quot;[mode]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">surface</span><span class="p">.</span><span class="nx">setMode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="c1">// on home button click, zoom content to fit.</span>
    <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">controls</span><span class="p">,</span> <span class="s2">&quot;tap&quot;</span><span class="p">,</span> <span class="s2">&quot;[reset]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">toolkit</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">();</span>
        <span class="nx">scope</span><span class="p">.</span><span class="nx">surface</span><span class="p">.</span><span class="nx">zoomToFit</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// configure Drawing tools. This is an optional include.</span>
    <span class="k">new</span> <span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">DrawingTools</span><span class="p">({</span>
        <span class="nx">renderer</span><span class="o">:</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">surface</span>
    <span class="p">});</span>

    <span class="c1">//</span>
    <span class="c1">// any operation that caused a data update (and would have caused an autosave), fires a dataUpdated event.</span>
    <span class="c1">//</span>
    <span class="nx">toolkit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;dataUpdated&quot;</span><span class="p">,</span> <span class="nx">_updateDataset</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>The main things to note here are that the <code>scope</code> passed in to this method contains <code>toolkit</code> and <code>surface</code> members. This
 demo assigns the <code>toolkit</code> member to a variable in the Controller&#39;s scope, so it is subsequently available
 everywhere.</p>

<p><a name="loading"></a></p>

<h3>Data Loading</h3>

<p>Data for this application is stored in <code>data/flowchart-1.json</code> inside the application folder. It is loaded by this 
code inside the <code>init</code> function:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">toolkit</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span><span class="s2">&quot;data/flowchart-1.json&quot;</span>
<span class="p">});</span>
</code></pre></div>
<hr>

<p><a name="dragging"></a></p>

<h3>Dragging New Nodes</h3>

<p>As discussed above, a <code>jsplumb-palette</code> is declared, which configures all of its child <code>li</code> elements to be droppable onto
the Surface canvas.  When a drop occurs, the type of the newly dragged node is calculated by the <code>typeExtractor</code> 
function declared on <code>DemoController</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">typeExtractor</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;jtk-node-type&quot;</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<hr>

<p><a name="behaviour"></a></p>

<h3>Behaviour</h3>

<p>In the original FlowchartBuilder demo, there are three pieces of behaviour that we need to code that are not 
completely handled for us by the Toolkit:  </p>

<ul>
<li>Edit Node Text</li>
<li>Delete Node</li>
<li>Remove Edge</li>
</ul>

<p>These exist in this Angular demo, too, but, for Nodes, are handled slightly differently:</p>

<h6>Edit Node Text</h6>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-edit node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;editNode(node)&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-pencil-square-o&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$scope</span><span class="p">.</span><span class="nx">editNode</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>    
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">surface</span><span class="p">.</span><span class="nx">getObjectInfo</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">Dialogs</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;dlgText&quot;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Edit &quot;</span> <span class="o">+</span> <span class="nx">info</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot; name&quot;</span><span class="p">,</span>
        <span class="nx">onOK</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">text</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// if name is at least 2 chars long, update the underlying data and</span>
                <span class="c1">// update the UI.</span>
                <span class="nx">toolkit</span><span class="p">.</span><span class="nx">updateNode</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>
<p>The meat of this method is the same as that which the original FlowchartBuilder demo has; it&#39;s just the trigger to
launch the method that is different.</p>

<p>Note here the <code>getObjectInfo</code> method: this is method with which you will want to acquaint yourself. It is defined on a 
Surface, not on a Toolkit instance, and takes a DOM element as argument and places it within the context of some object 
managed by the Toolkit instance that the Surface is associated with. In this case, the click event occurs on an 
icon. <code>getObjectInfo</code> traverses up the icon&#39;s ancestors until it finds an element that is associated with a Toolkit 
object - in our app, either a Table or View. When a Toolkit object is found, getObjectInfo returns an object with these 
values:</p>

<ul>
<li><strong>id</strong> ID of the Toolkit object</li>
<li><strong>obj</strong> The associated Toolkit object. May be a Node or a Port.</li>
<li><strong>el</strong> The DOM element for the Toolkit object</li>
<li><strong>type</strong> The type of the Toolkit object. This will be &quot;Node&quot; or &quot;Port&quot;.</li>
</ul>

<p>In this event handler, we show the user a dialog that will allow them to edit the Node&#39;s text. If the edited text is 
at least two character long we update the model.</p>

<p>This application uses the Toolkit&#39;s <a href="dialogs.html">dialogs</a> import to manage simple interactions with data members such as 
this. Your application may choose to use a different mechanism.</p>

<h6>Delete Node</h6>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;node-delete node-action&quot;</span> <span class="na">ng-click=</span><span class="s">&quot;removeNode(node)&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fa fa-times&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h6>Remove Edge</h6>

<p>This is handled in the same way by this demo as it is in the original FlowchartBuider.</p>

<p>We register a <code>dblclick</code> listener on edges by providing it as an event handler to the View, on the edge type that 
acts as the parent type for all others:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">...</span>
<span class="nx">edges</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">connector</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Flowchart&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cornerRadius</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">],</span>
    <span class="nx">paintStyle</span><span class="o">:</span> <span class="p">{</span> <span class="nx">lineWidth</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">strokeStyle</span><span class="o">:</span> <span class="s2">&quot;#f76258&quot;</span><span class="p">,</span> <span class="nx">outlineWidth</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">outlineColor</span><span class="o">:</span> <span class="s2">&quot;transparent&quot;</span> <span class="p">},</span> 
    <span class="nx">hoverPaintStyle</span><span class="o">:</span> <span class="p">{</span> <span class="nx">lineWidth</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">strokeStyle</span><span class="o">:</span> <span class="s2">&quot;rgb(67,67,67)&quot;</span> <span class="p">},</span> 
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;dblclick&quot;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">Dialogs</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
          <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;dlgConfirm&quot;</span><span class="p">,</span>
          <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">msg</span><span class="o">:</span> <span class="s2">&quot;Delete Edge&quot;</span>
          <span class="p">},</span>
          <span class="nx">onOK</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">toolkit</span><span class="p">.</span><span class="nx">removeEdge</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">edge</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
   <span class="p">},</span>

<span class="p">...</span>
</code></pre></div>
<h6>Editing Edge Label</h6>

<p>All Edges except those from a <em>Start</em> node are set to be of type <code>connection</code>, which is defined in the view as follows:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s2">&quot;connection&quot;</span><span class="o">:</span><span class="p">{</span>
  <span class="nx">parent</span><span class="o">:</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
  <span class="nx">overlays</span><span class="o">:</span><span class="p">[</span>
    <span class="p">[</span> <span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">label</span><span class="o">:</span> <span class="s2">&quot;${label}&quot;</span><span class="p">,</span>
      <span class="nx">events</span><span class="o">:</span><span class="p">{</span>
        <span class="nx">click</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_editLabel</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">edge</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}]</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>We define a <code>click</code> event handler on the Label overlay which edits the label for the Edge.</p>

<hr>

<p><a id="resizedrag"></a></p>

<h3>Resizing/Dragging Nodes</h3>

<p>To resize or drag a node first you must either click on it, or use the lasso (described <a href="#selecting">below</a>) to select 
it.  A selected node looks like this:</p>

<p><img src="flowchart-selected-node.png" alt="Selected Node"></p>

<p>The dotted line and drag handles that are added to a selected Node are put there by the optional Tookit drawing  script. It listens to the Toolkit&#39;s select/deselect events and decorates UI elements accordingly. These tools are discussed in detail on <a href="drawing.html">this page</a>.</p>

<p>The drawing tools are initialized with this line of code (inside <code>DemoController.init</code>):</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// configure Drawing tools. This is an optional include.</span>
<span class="k">new</span> <span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">DrawingTools</span><span class="p">({</span><span class="nx">renderer</span><span class="o">:</span> <span class="nx">renderer</span><span class="p">});</span>
</code></pre></div>
<p>You pass them the instance of the Surface widget you&#39;re working with.</p>

<h4>Dragging</h4>

<p>Nodes can be dragged only by the square in the center of the node. This is achieved by setting a <code>filter</code> on the 
<code>dragOptions</code> parameter on the <code>render</code> call:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">dragOptions</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">handle</span><span class="o">:</span> <span class="s2">&quot;.jtk-draw-drag&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>jtk-draw-drag</code> is the classname of the square that the drawing tools place in the center of a selected node.</p>

<h4>Resizing</h4>

<p>Resizing is handled automatically by the drawing tools.  By default, these tools will change the <code>w</code>, <code>h</code>, <code>left</code> and <code>top</code> values in a node&#39;s data, but this can be changed.</p>

<p>When a node&#39;s data is updated the drawing tools call the appropriate update method on the underlying Toolkit. The changes 
will be reflected immediately in the DOM.</p>

<hr>

<p><a id="selecting"></a></p>

<h3>Selecting Nodes</h3>

<h5>Left Click</h5>

<p>Nodes can be selected with a left-click (or tap on a touch device; <code>tap</code> is a better event to choose in general because the
Toolkit abstracts out the difference between mouse devices and touch devices and presents <code>click</code> events as <code>tap</code> events
on non touch devices).  This is configured in the <code>view</code> parameter to the <code>render</code> call. In this application, 
Nodes of type <em>selectable</em> have the capability enabled with this code:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s2">&quot;selectable&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tap</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">toolkit</span><span class="p">.</span><span class="nx">toggleSelection</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>tap</code> event (discussed <a href="widget-surface.html#eventlist">here</a>) is preferable to <code>click</code>, as it ensures the application responds only to true clicks on devices with a mouse, and also avoids the delay that some vendors introduce to a click event on touch devices.</p>

<h5>Lasso Selection</h5>

<p>Lasso selection is enabled by default on the Surface widget. </p>

<p>To activate the lasso, click the pencil icon in the toolbar:</p>

<p><img src="select-lasso.png" alt="Lasso Select Mode"></p>

<p>The code that listens to clicks on this icon is as follows:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// listener for mode change on renderer.</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;modeChanged&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">getSelector</span><span class="p">(</span><span class="s2">&quot;[mode]&quot;</span><span class="p">),</span> <span class="s2">&quot;selected-mode&quot;</span><span class="p">);</span>
  <span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">getSelector</span><span class="p">(</span><span class="s2">&quot;[mode=&#39;&quot;</span> <span class="o">+</span> <span class="nx">mode</span> <span class="o">+</span> <span class="s2">&quot;&#39;]&quot;</span><span class="p">),</span> <span class="s2">&quot;selected-mode&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// pan mode/select mode</span>
<span class="nx">jsPlumb</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;.controls&quot;</span><span class="p">,</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;[mode]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nx">setMode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">));</span>
<span class="p">});</span>
</code></pre></div>
<p>Here we&#39;ve registered an event listener to be informed when the Surface&#39;s mode has changed; it is responsible for setting the appropriate classes on the toolbar items.  The click listener extracts the desired mode from the button that was clicked and sets it on the renderer.</p>

<h5>Lasso Operation</h5>

<p>The lasso works in two ways: when you drag from left to right, any node that intersects your lasso will be selected.  When you drag from right to left, only nodes that are enclosed by your lasso will be selected.</p>

<p><img src="lasso-select-operation.png" alt="Lasso Operation"></p>

<h5>Exiting Select Mode</h5>

<p>The Surface widget automatically exits select mode once the user has selected something. In this application we also listen to clicks on the whitespace in the widget and switch back to pan mode when we detect one. This is the <code>events</code> argument to the <code>render</code> call:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">canvasClick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toolkit</span><span class="p">.</span><span class="nx">clearSelection</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>clearSelection</code> clears the current selection and switches back to Pan mode.</p>

<hr>

<p><a id="dialogs"></a></p>

<h3>Dialogs</h3>

<p>The dialogs used in this app are part of the jsPlumb Toolkit core. They provide a simple abstraction around the business of getting input from the user and dealing with it; they&#39;re not necessarily fully-featured enough for all applications.</p>

<h4>Initialization</h4>

<p>To initialize the dialogs, first call <code>jsPlumbToolkit.Dialogs.initialize</code>, with an appropriate selector for the templates for your dialogs (see below for an explanation of this):</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">Dialogs</span><span class="p">.</span><span class="nx">initialize</span><span class="p">({</span>
  <span class="nx">selector</span><span class="o">:</span><span class="s2">&quot;.dlg&quot;</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">showDialog</span> <span class="o">=</span> <span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">Dialogs</span><span class="p">.</span><span class="nx">show</span><span class="p">;</span>
</code></pre></div>
<p>Note here we&#39;ve also aliased <code>jsPlumbToolkit.Dialogs.show</code>, to save some typing.</p>

<h4>Templates</h4>

<p>Each dialog has a template in the HTML, with some class name that you matched in the <code>selector</code> argument to the <code>initialize</code> call above:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;jtk&quot;</span> <span class="na">class=</span><span class="s">&quot;dlg&quot;</span> <span class="na">id=</span><span class="s">&quot;dlgViewQuery&quot;</span> <span class="na">title=</span><span class="s">&quot;Edit Query&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">class=</span><span class="s">&quot;txtViewQuery&quot;</span> <span class="err">jtk-focus</span> <span class="na">jtk-att=</span><span class="s">&quot;query&quot;</span><span class="nt">&gt;</span>${query}<span class="nt">&lt;/textarea&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<h5>Binding Parameters</h5>

<p>These templates use the same template engine as the Surface renderer, so in this example you can see we&#39;ve extracted <code>query</code> from the View node&#39;s data, and injected it into the textarea. But what might not be immediately obvious is the purpose of the <code>jtk-att</code> attribute: it tells the dialog handler that the value of this textarea should be passed to the OK handler, using the key <code>query</code>.</p>

<p>Note also in the above example, the <code>jtk-focus</code> attribute: this tells the dialog handler that the textarea should be given the focus when the dialog first opens.</p>

<h4>Showing a dialog</h4>

<p>This example is the dialog that is shown when you edit a View query. We provide the id of the template to use for the dialog, and we provide the View node&#39;s data as the backing data for the dialog. Then we provide an <code>onOK</code> callback:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">jsPlumbToolkit</span><span class="p">.</span><span class="nx">Dialogs</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
  <span class="nx">id</span><span class="o">:</span><span class="s2">&quot;dlgViewQuery&quot;</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span><span class="nx">info</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
  <span class="nx">onOK</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// update data</span>
    <span class="nx">toolkit</span><span class="p">.</span><span class="nx">updateNode</span><span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="c1">// update UI                    </span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s2">&quot;.view-details&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>data</code> argument to the <code>onOK</code> callback consists of an object whose key value pairs are determined by the <code>jtk-att</code> attributes found in the template. Recall that above we had a textarea with <code>jtk-att:&quot;query&quot;</code>. This means that the <code>data</code> argument to <code>onOK</code> looks like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">query</span><span class="o">:</span><span class="s2">&quot;the contents of the text area&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h5>Supported Input Types</h5>

<p>The list of supported input types is:</p>

<ul>
<li>text</li>
<li>radio button(s) </li>
<li>checkbox</li>
<li>select</li>
<li>textarea</li>
</ul>

<h5>Dialog Titles</h5>

<p>If you set a <code>title</code> attribute on a dialog&#39;s template, that value will be used for the title of the dialog. 
Alternatively, you can provide a <code>title</code> parameter to the <code>show</code> call.</p>

<h5>Lifecycle Callbacks</h5>

<p>There are three lifecycle callbacks supported:</p>

<ul>
<li><strong>onOpen</strong> Called when the dialog has been opened. The related DOM element for the dialog is passed to this method.</li>
<li><strong>onOK</strong> Called when the user presses OK. The callback is provided a data object as discussed above.</li>
<li><strong>onCancel</strong> Called when the user presses cancel. No arguments are provided to the callback.</li>
</ul>

                </div>
            </div>
        </div>

    </body>

</html>
