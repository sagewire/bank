(function(){"Alchemy.js is a graph drawing application for the web.\nCopyright (C) 2014  GraphAlchemist, Inc.\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU Affero General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Affero General Public License for more details.\n\nYou should have received a copy of the GNU Affero General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\nlets";var r,n,e,o,s,h,c,v,y,p,f,l,u,a,i=[].slice,t=function(n,t){return function(){return n.apply(t,arguments)}};n=function(){function n(n){n==null&&(n=null);this.a=this;this.version="0.4.2";this.api=new r(this);this.get=this.api.get;this.create=this.api.create;this.set=this.api.set;this.filter=this.api.filter;this.forceLayout=this.api.force;this.drawing={DrawEdge:o(this),DrawEdges:s(this),DrawNode:h(this),DrawNodes:c(this),NodeUtils:this.NodeUtils(this)};this.controlDash=this.controlDash(this);this.stats=this.stats(this);this.search=this.search(this);this.layout=f;this.clustering=e;this.models={Node:this.Node(this),Edge:this.Edge(this)};this.utils={warnings:new a(this)};this.filters=this.filters(this);this.exports=this.exports(this);this.visControls={};this.styles={};this.editor={};this.log={};this.state={interactions:"default",layout:"default"};this.startGraph=this.startGraph(this);this.updateGraph=this.updateGraph(this);this.generateLayout=this.generateLayout(this);this.svgStyles=this.svgStyles(this);this.interactions=this.interactions(this);this.plugins=this.plugins(this);this._nodes={};this._edges={};this.getNodes=this.get.getNodes;this.getEdges=this.get.getEdges;this.allNodes=this.get.allNodes;this.allEdges=this.get.allEdges;n&&this.begin(n)}return n.prototype.begin=function(t){var i=this.setConf(t);switch(typeof this.conf.dataSource){case"string":d3.json(this.a.conf.dataSource,this.a.startGraph);break;case"object":this.a.startGraph(this.a.conf.dataSource)}return this.plugins.init(),n.prototype.instances.push(this),this},n.prototype.setConf=function(n){var i,t;n.theme!=null&&(n=_.merge(_.cloneDeep(this.defaults),this.a.themes[""+n.theme]));for(i in n){t=n[i];switch(i){case"clusterColors":n.clusterColours=t;break;case"backgroundColor":n.backgroundColour=t;break;case"nodeColor":n[nodeColour]=t}}return this.a.conf=_.merge(_.cloneDeep(this.defaults),n)},n.prototype.instances=[],n.prototype.getInst=function(t){var i;return i=parseInt(d3.select(t).attr("alchInst")),n.prototype.instances[i]},n}();u=typeof exports!="undefined"&&exports!==null?exports:this;u.Alchemy=n;u.alchemy={begin:function(t){return u.alchemy=new n(t)}};r=function(){function n(n){this.a=n;this.get=this.Get(n,this);this.create=this.Create(n,this);this.set=this.Set(n,this);this.remove=l.remove;this.force=this.Force(n,this);this.filter=this.Filter(n,this);this.search=this.Search(n,this);this._el=[];this._elType=null;this._makeChain=function(n,t){var r,i,u;for(this.__proto__=[].__proto__,t.__proto__=[].__proto__;this.length;)this.pop();while(t.length)t.pop();for(i=0,u=n.length;i<u;i++)r=n[i],this.push(r);return Array.prototype.push.apply(t,this._el),_.extend(t,this)}}return n}();r.prototype.Create=function(t,r){return{a:t,api:r,nodes:function(){var t,f,s,r,e,u,o;for(s=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],t=this.a,e=function(n){var i;return t._nodes[n.id]?console.warn("A node with the id "+n.id+" already exists.\nConsider using the @a.get.nodes() method to \nretrieve the node and then using the Node methods."):(i=new t.models.Node(n),t._nodes[n.id]=i,[i])},r=_.uniq(_.flatten(arguments)),u=0,o=r.length;u<o;u++)f=r[u],e(f);if(this.a.initial)return this.a.index=n.prototype.Index(this.a),this.a.updateGraph()},edges:function(){var t,r,f,e,u;return f=arguments[0],e=2<=arguments.length?i.call(arguments,1):[],t=this.a,u=function(n){var i,r;return n.id&&!t._edges[n.id]?(i=new t.models.Edge(n),t._edges[n.id]=[i],[i]):n.id&&t._edges[n.id]?console.warn("An edge with that id "+someEdgeMap.id+" already exists.\nConsider using the @a.get.edge() method to \nretrieve the edge and then using the Edge methods.\nNote: id's are not required for edges.  Alchemy will create\nan unlimited number of edges for the same source and target node.\nSimply omit 'id' when creating the edge."):(r=t._edges[""+n.source+"-"+n.target],r?(i=new t.models.Edge(n,r.length),r.push(i),[i]):(i=new t.models.Edge(n,0),t._edges[""+n.source+"-"+n.target]=[i],[i]))},r=_.uniq(_.flatten(arguments)),_.each(r,function(n){return u(n)}),this.a.initial?(this.a.index=n.prototype.Index(this.a),this.a.updateGraph()):void 0}}};r.prototype.Filter=function(n,t){var r,i;return r=n,i=function(n){return _.each(t._el,function(i){var r;return r=function(){return t._elType==="edge"&&"_edgeType",t._elType==="node"?"_nodeType":void 0}(),i[r]===n?i.toggleHidden():void 0})},i.nodes=function(n){var t;return t=r.elements.nodes.val,_.each(t,function(t){if(t._nodeType===n)return t.toggleHidden()})},i.edges=function(n){var t;return t=r.elements.edges.flat,_.each(t,function(t){if(t._edgeType===n)return t.toggleHidden()})},i};r.prototype.Force=function(n){var t;return t=n,{toggle:function(){return t.force.alpha()>0?t.force.stop():t.force.resume()},start:function(){return t.force.start()},stop:function(){return t.force.stop()}}};r.prototype.Get=function(n,t){return{a:n,api:t,nodes:function(){var t,r,u,f,e,n;return f=arguments[0],e=2<=arguments.length?i.call(arguments,1):[],n=[],f!=null&&(u=_.flatten(arguments),r=_.map(u,function(n){return String(n)}),t=this.a,n=function(n){return _.filter(n._nodes,function(n,t){if(_.contains(r,t))return n})}(t)),this.api._elType="node",this.api._el=n,this.api._makeChain(n,this)},edges:function(){var t,r,n,u,f;return u=arguments[0],f=2<=arguments.length?i.call(arguments,1):[],n=[],u!=null&&(r=_.map(arguments,function(n){return String(n)}),t=this.a,n=function(n){return _.flatten(_.filter(n._edges,function(n,t){if(_.contains(r,t))return n}))}(t)),this.api._elType="edge",this.api._el=n,this.api._makeChain(n,this)},all:function(){var n,t;return n=this.a,t=this.api._elType,this.api._el=function(t){switch(t){case"node":return n.elements.nodes.val;case"edge":return n.elements.edges.flat}}(t),this.api._makeChain(this.api._el,this)},elState:function(n){var t;return t=_.filter(this.api._el,function(t){return t._state===n}),this.api._el=t,this.api._makeChain(t,this)},state:function(){if(this.a.state.key!=null)return this.a.state.key},type:function(n){var t;return t=_.filter(this.api._el,function(t){return t._nodeType===n||t._edgeType===n}),this.api._el=t,this.api._makeChain(t,this)},activeNodes:function(){return _.filter(this.a._nodes,function(n){if(n._state==="active")return n})},activeEdges:function(){return _.filter(this.a.get.allEdges(),function(n){if(n._state==="active")return n})},state:function(){if(this.a.state.key!=null)return this.a.state.key},clusters:function(){var t,n;return t=this.a.layout._clustering.clusterMap,n={},_.each(t,function(t,i){return n[i]=_.select(this.a.get.allNodes(),function(n){return n.getProperties()[this.a.conf.clusterKey]===i})}),n},clusterColours:function(){var n,t;return t=this.a.layout._clustering.clusterMap,n={},_.each(t,function(t,i){return n[i]=this.a.conf.clusterColours[t%this.a.conf.clusterColours.length]}),n},allEdges:function(){return this.a.elements.nodes.flat},allNodes:function(n){return n!=null?_.filter(this.a._nodes,function(t){if(t._nodeType===n)return t}):this.a.elements.nodes.val},getNodes:function(){var t,r,n;return r=arguments[0],n=2<=arguments.length?i.call(arguments,1):[],t=this.a,n.push(r),_.map(n,function(n){return t._nodes[n]})},getEdges:function(n,t){var r,i;return(n==null&&(n=null),t==null&&(t=null),r=this.a,n!=null&&t!=null)?(i=""+n+"-"+t,this.a._edges[i]):n!=null&&t==null?this.a._nodes[n]._adjacentEdges:void 0}}};l={remove:function(){return _.each(this._el,function(n){return n.remove()})}};r.prototype.Search=function(n,t){var i,r;return i=n,r=function(n){var r;return n=function(){return i.conf.searchMethod==="contains"?n:i.conf.searchMethod==="begins"?"^"+n:void 0}(),r=new RegExp(n,"i"),_.filter(t._el,function(n){return r.test(n._properties.caption)})},r.nodes=function(n){var t;return n=function(){return i.conf.searchMethod==="contains"?n:i.conf.searchMethod==="begins"?"^"+n:void 0}(),t=new RegExp(n,"i"),_.filter(i._nodes,function(n){return t.test(n._properties.caption)})},r.edges=function(n){var t;return n=function(){return i.conf.searchMethod==="contains"?n:i.conf.searchMethod==="begins"?"^"+n:void 0}(),t=new RegExp(n,"i"),_.filter(i.elements.edges.flat,function(n){return t.test(n._properties.caption)})},r};r.prototype.Set=function(n,t){return{a:n,api:t,state:function(n,t){return this.a.state.key=t}}};e=function(){function n(n){var s,i,t,r,u,f,e,o;this.a=n;t=this.a._nodes;i=this.a.conf;s=this;this.clusterKey=i.clusterKey;this.identifyClusters(this.a);r=-500;o=function(n){var i,r;return i=t[n.source.id]._properties[this.clusterKey],r=t[n.target.id]._properties[this.clusterKey],i===r?.15:0};u=function(){return.7};e=function(n){return t=n.self.a._nodes,t[n.source.id]._properties.root||t[n.target.id]._properties.root?300:t[n.source.id]._properties[this.clusterKey]===t[n.target.id]._properties[this.clusterKey]?10:600};f=function(n){return 8*n};this.layout={charge:r,linkStrength:function(n){return o(n)},friction:function(){return u()},linkDistancefn:function(n){return e(n)},gravity:function(n){return f(n)}}}return n.prototype.identifyClusters=function(n){var t,r,i;return r=n.elements.nodes.val,t=_.uniq(_.map(r,function(t){return t.getProperties()[n.conf.clusterKey]})),this.clusterMap=_.zipObject(t,function(){i=[];for(var n=0,r=t.length;0<=r?n<=r:n>=r;0<=r?n++:n--)i.push(n);return i}.apply(this))},n.prototype.getClusterColour=function(n){var t;return t=this.clusterMap[n]%this.a.conf.clusterColours.length,this.a.conf.clusterColours[t]},n.prototype.edgeGradient=function(n){var r,c,t,l,o,a,u,f,i,v,e,y,s,h;for(c=this.a.vis.select(""+this.a.conf.divSelector+" svg"),r={},i=this.a._nodes,s=_.map(n,function(n){return n._d3}),e=0,y=s.length;e<y;e++)if((t=s[e],!i[t.source.id]._properties.root&&!i[t.target.id]._properties.root)&&i[t.source.id]._properties[this.clusterKey]!==i[t.target.id]._properties[this.clusterKey]&&i[t.target.id]._properties[this.clusterKey]!==i[t.source.id]._properties[this.clusterKey])if(u=i[t.source.id]._properties[this.clusterKey]+"-"+i[t.target.id]._properties[this.clusterKey],u in r)continue;else u in r||(v=this.getClusterColour(i[t.target.id]._properties[this.clusterKey]),l=this.getClusterColour(i[t.source.id]._properties[this.clusterKey]),r[u]={startColour:v,endColour:l});h=[];for(f in r)a="cluster-gradient-"+f,o=c.append("svg:linearGradient").attr("id",a),o.append("svg:stop").attr("offset","0%").attr("stop-color",r[f].startColour),h.push(o.append("svg:stop").attr("offset","100%").attr("stop-color",r[f].endColour));return h},n}();n.prototype.clusterControls={init:function(){var n;n="<input class='form-control form-inline' id='cluster-key' placeholder=\"Cluster Key\"><\/input>";this.a.dash.select("#clustering-container").append("div").attr("id","cluster-key-container").attr("class","property form-inline form-group").html(n).style("display","none");this.a.dash.select("#cluster_control_header").on("click",function(){var n;return n=this.a.dash.select("#cluster-key-container"),n.style("display")});element.style("display",function(){return display==="block"?"none":"block"});this.a.dash.select("#cluster-key-container").style("display")==="none"?this.a.dash.select("#cluster-arrow").attr("class","fa fa-2x fa-caret-right"):this.a.dash.select("#cluster-arrow").attr("class","fa fa-2x fa-caret-down");return this.a.dash.select("#cluster-key").on("keydown",function(){if(d3.event.keyIdentifier==="Enter")return this.a.conf.cluster=!0,this.a.conf.clusterKey=this.value,this.a.generateLayout()})}};n.prototype.controlDash=function(n){var t;return t=n,{init:function(){var n;if(this.dashIsShown()){n=t.conf.divSelector;t.dash=d3.select(""+n).append("div").attr("id","control-dash-wrapper").attr("class","col-md-4 initial");t.dash.append("i").attr("id","dash-toggle").attr("class","fa fa-flask col-md-offset-12");t.dash.append("div").attr("id","control-dash").attr("class","col-md-12");t.dash.select("#dash-toggle").on("click",t.interactions.toggleControlDash);return t.controlDash.zoomCtrl(),t.controlDash.search(),t.controlDash.filters(),t.controlDash.stats(),t.controlDash.clustering(),t.controlDash.exports()}},search:function(){if(t.conf.search)return t.dash.select("#control-dash").append("div").attr("id","search").html("<div class='input-group'>\n    <input class='form-control' placeholder='Search'>\n    <i class='input-group-addon search-icon'><span class='fa fa-search fa-1x'><\/span><\/i>\n<\/div> "),t.search.init()},zoomCtrl:function(){if(t.conf.zoomControls){t.dash.select("#control-dash-wrapper").append("div").attr("id","zoom-controls").attr("class","col-md-offset-12").html("<button id='zoom-reset'  class='btn btn-defualt btn-primary'><i class='fa fa-crosshairs fa-lg'><\/i><\/button> <button id='zoom-in'  class='btn btn-defualt btn-primary'><i class='fa fa-plus'><\/i><\/button> <button id='zoom-out' class='btn btn-default btn-primary'><i class='fa fa-minus'><\/i><\/button>");t.dash.select("#zoom-in").on("click",function(){return t.interactions.clickZoom("in")});t.dash.select("#zoom-out").on("click",function(){return t.interactions.clickZoom("out")});return t.dash.select("#zoom-reset").on("click",function(){return t.interactions.clickZoom("reset")})}},filters:function(){if(t.conf.nodeFilters||t.conf.edgeFilters)return t.dash.select("#control-dash").append("div").attr("id","filters"),t.filters.init()},stats:function(){var n;if(t.conf.nodeStats||t.conf.edgeStats){n='<div id = "stats-header" data-toggle="collapse" data-target="#stats #all-stats">\n<h3>\n    Statistics\n<\/h3>\n<span class = "fa fa-caret-right fa-2x"><\/span>\n<\/div>\n<div id="all-stats" class="collapse">\n    <ul class = "list-group" id="node-stats"><\/ul>\n    <ul class = "list-group" id="rel-stats"><\/ul>  \n<\/div>';t.dash.select("#control-dash").append("div").attr("id","stats").html(n).select("#stats-header").on("click",function(){return t.dash.select("#all-stats").classed("in")?t.dash.select("#stats-header>span").attr("class","fa fa-2x fa-caret-right"):t.dash.select("#stats-header>span").attr("class","fa fa-2x fa-caret-down")});return t.stats.init()}},exports:function(){var n;if(t.conf.exportSVG)return n='<div id="exports-header" data-toggle="collapse" data-target="#all-exports" style="padding:10px;">\n    <h3>\n        Exports\n    <\/h3>\n    <span class="fa fa-caret-right fa-2x"><\/span>\n<\/div>\n<div id="all-exports" class="collapse"><\/div>',t.dash.select("#control-dash").append("div").attr("id","exports").attr("style","padding: 0.5em 1em; border-bottom: thin dashed #E89619; color: white;").html(n).select("#exports-header"),t.exports.init()},clustering:function(){var n;if(t.conf.clusterControl)return n='<div id="clustering-container">\n    <div id="cluster_control_header" data-toggle="collapse" data-target="#clustering #cluster-options">\n         <h3>Clustering<\/h3>\n        <span id="cluster-arrow" class="fa fa-2x fa-caret-right"><\/span>\n    <\/div>\n<\/div>',t.dash.select("#control-dash").append("div").attr("id","clustering").html(n).select("#cluster_control_header"),t.clusterControls.init()},dashIsShown:function(){var n;return n=t.conf,n.showEditor||n.captionToggle||n.toggleRootNodes||n.removeElement||n.clusterControl||n.nodeStats||n.edgeStats||n.edgeFilters||n.nodeFilters||n.edgesToggle||n.nodesToggle||n.search||n.exportSVG}}};n.prototype.filters=function(){return function(n){var t;return t=n,{init:function(){var n,i,e,c,r,o,s,u,f,l,a,h;if(t.filters.show(),t.conf.edgeFilters&&t.filters.showEdgeFilters(),t.conf.nodeFilters&&t.filters.showNodeFilters(),t.conf.nodeTypes){for(c=Object.keys(t.conf.nodeTypes),o="",h=t.conf.nodeTypes[c],u=0,l=h.length;u<l;u++)r=h[u],n=r.replace("_"," "),o+="<li class='list-group-item nodeType' role='menuitem' id='li-"+r+"' name="+r+">"+n+"<\/li>";t.dash.select("#node-dropdown").html(o)}if(t.conf.edgeTypes){for(s=_.isPlainObject(t.conf.edgeTypes)?_.values(t.conf.edgeTypes)[0]:t.conf.edgeTypes,e="",f=0,a=s.length;f<a;f++)i=s[f],n=i.replace("_"," "),e+="<li class='list-group-item edgeType' role='menuitem' id='li-"+i+"' name="+i+">"+n+"<\/li>";t.dash.select("#rel-dropdown").html(e)}return t.conf.captionsToggle&&t.filters.captionsToggle(),t.conf.edgesToggle&&t.filters.edgesToggle(),t.conf.nodesToggle&&t.filters.nodesToggle(),t.filters.update()},show:function(){var n;n='<div id = "filter-header" data-toggle="collapse" data-target="#filters form">\n    <h3>Filters<\/h3>\n    <span class = "fa fa-2x fa-caret-right"><\/span>\n<\/div>\n    <form class="form-inline collapse">\n    <\/form>';t.dash.select("#control-dash #filters").html(n);t.dash.selectAll("#filter-header").on("click",function(){return t.dash.select("#filters>form").classed("in")?t.dash.select("#filter-header>span").attr("class","fa fa-2x fa-caret-right"):t.dash.select("#filter-header>span").attr("class","fa fa-2x fa-caret-down")});return t.dash.select("#filters form")},showEdgeFilters:function(){var n;n='<div id="filter-rel-header" data-target = "#rel-dropdown" data-toggle="collapse">\n    <h4>\n        Edge Types\n    <\/h4>\n    <span class="fa fa-lg fa-caret-right"><\/span>\n<\/div>\n<ul id="rel-dropdown" class="collapse list-group" role="menu">\n<\/ul>';t.dash.select("#filters form").append("div").attr("id","filter-relationships").html(n);return t.dash.select("#filter-rel-header").on("click",function(){return t.dash.select("#rel-dropdown").classed("in")?t.dash.select("#filter-rel-header>span").attr("class","fa fa-lg fa-caret-right"):t.dash.select("#filter-rel-header>span").attr("class","fa fa-lg fa-caret-down")})},showNodeFilters:function(){var n;n='<div id="filter-node-header" data-target = "#node-dropdown" data-toggle="collapse">\n    <h4>\n        Node Types\n    <\/h4>\n    <span class="fa fa-lg fa-caret-right"><\/span>\n<\/div>\n<ul id="node-dropdown" class="collapse list-group" role="menu">\n<\/ul>';t.dash.select("#filters form").append("div").attr("id","filter-nodes").html(n);return t.dash.select("#filter-node-header").on("click",function(){return t.dash.select("#node-dropdown").classed("in")?t.dash.select("#filter-node-header>span").attr("class","fa fa-lg fa-caret-right"):t.dash.select("#filter-node-header>span").attr("class","fa fa-lg fa-caret-down")})},captionsToggle:function(){return t.dash.select("#filters form").append("li").attr({id:"toggle-captions","class":"list-group-item active-label toggle"}).html("Show Captions").on("click",function(){var n;return n=t.dash.select("g text").attr("style"),n==="display: block"||null?t.dash.selectAll("g text").attr("style","display: none"):t.dash.selectAll("g text").attr("style","display: block")})},edgesToggle:function(){return t.dash.select("#filters form").append("li").attr({id:"toggle-edges","class":"list-group-item active-label toggle"}).html("Toggle Edges").on("click",function(){return _.contains(_.pluck(_.flatten(_.values(t._edges)),"_state"),"active")?_.each(_.values(t._edges),function(n){return _.each(n,function(n){if(n._state==="active")return n.toggleHidden()})}):_.each(_.values(t._edges),function(n){return _.each(n,function(n){var i,r;return i=t._nodes[n._properties.source],r=t._nodes[n._properties.target],i._state==="active"&&r._state==="active"?n.toggleHidden():void 0})})})},nodesToggle:function(){return t.dash.select("#filters form").append("li").attr({id:"toggle-nodes","class":"list-group-item active-label toggle"}).html("Toggle Nodes").on("click",function(){var n;return n=_.values(t._nodes),_.contains(_.pluck(n,"_state"),"active")?_.each(n,function(n){if(!t.conf.toggleRootNodes||!n._d3.root)return n._state==="active"?n.toggleHidden():void 0}):_.each(_.values(t._nodes),function(n){if(!t.conf.toggleRootNodes||!n._d3.root)return n.toggleHidden()})})},update:function(){return t.dash.selectAll(".nodeType, .edgeType").on("click",function(){var n,i;return n=d3.select(this),i=n.attr("name"),t.vis.selectAll("."+i).each(function(n){var i,r,u,f;return t._nodes[n.id]!=null?(r=t._nodes[n.id],r.toggleHidden()):(i=t._edges[n.id][0],u=t._nodes[i._properties.source],f=t._nodes[i._properties.target],u._state==="active"&&f._state==="active")?i.toggleHidden():void 0}),t.stats.nodeStats()})}}}}(this);n.prototype.Index=function(n){var t,r,i,u;return t=n,i={nodes:{val:function(){return _.values(t._nodes)}()},edges:{val:function(){return _.values(t._edges)}()}},u=i.nodes,r=i.edges,i.edges.flat=function(){return _.flatten(r.val)}(),i.nodes.d3=function(){return _.map(u.val,function(n){return n._d3})}(),i.edges.d3=function(){return _.map(r.flat,function(n){return n._d3})}(),t.initial&&(i.nodes.svg=function(){return t.vis.selectAll("g.node")}(),i.edges.svg=function(){return t.vis.selectAll("g.edge")}()),t.elements=i,function(){return t.elements.nodes.svg=function(){return t.vis.selectAll("g.node")}(),t.elements.edges.svg=function(){return t.vis.selectAll("g.edge")}()}};n.prototype.interactions=function(t){var i;return i=t,{edgeClick:function(n){var t;if(!d3.event.defaultPrevented)return d3.event.stopPropagation(),t=n.self,typeof i.conf.edgeClick=="function"&&i.conf.edgeClick(t),t._state!=="hidden"?(t._state=t._state==="highlighted"?"selected":"active",t.setStyles()):void 0},edgeMouseOver:function(n){var t;return t=n.self,t._state!=="hidden"?(t._state!=="selected"&&(t._state="highlighted"),t.setStyles()):void 0},edgeMouseOut:function(n){var t;return t=n.self,t._state!=="hidden"?(t._state!=="selected"&&(t._state="active"),t.setStyles()):void 0},nodeMouseOver:function(n){var t;if(t=n.self,t._state!=="hidden"){if(t._state!=="selected"&&(t._state="highlighted",t.setStyles()),typeof i.conf.nodeMouseOver=="function")return i.conf.nodeMouseOver(t);if(typeof i.conf.nodeMouseOver=="number")return t.properties[i.conf.nodeMouseOver]}},nodeMouseOut:function(n){var t;return t=n.self,i=t.a,t._state!=="hidden"&&(t._state!=="selected"&&(t._state="active",t.setStyles()),i.conf.nodeMouseOut!=null&&typeof i.conf.nodeMouseOut=="function")?i.conf.nodeMouseOut(n):void 0},nodeClick:function(n){var t;if(!d3.event.defaultPrevented)return d3.event.stopPropagation(),t=n.self,typeof i.conf.nodeClick=="function"&&i.conf.nodeClick(t),t._state!=="hidden"?(t._state=function(){return t._state==="selected"?"active":"selected"}(),t.setStyles()):void 0},zoom:function(t){this._zoomBehavior==null&&(this._zoomBehavior=d3.behavior.zoom());return this._zoomBehavior.scaleExtent(t).on("zoom",function(){return i=n.prototype.getInst(this),i.vis.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")})},clickZoom:function(n){var t,r,u,f;return f=i.vis.attr("transform").match(/(-*\d+\.*\d*)/g).map(function(n){return parseFloat(n)}),r=f[0],u=f[1],t=f[2],i.vis.attr("transform",function(){return n==="in"?(t<i.conf.scaleExtent[1]&&(t+=.2),"translate("+r+","+u+") scale("+t+")"):n==="out"?(t>i.conf.scaleExtent[0]&&(t-=.2),"translate("+r+","+u+") scale("+t+")"):n==="reset"?"translate(0,0) scale(1)":console.log("error")}),this._zoomBehavior==null&&(this._zoomBehavior=d3.behavior.zoom()),this._zoomBehavior.scale(t).translate([r,u])},toggleControlDash:function(){var n;return n=i.dash.classed("off-canvas")||i.dash.classed("initial"),i.dash.classed({"off-canvas":!n,initial:!1,"on-canvas":n})},nodeDragStarted:function(n){return d3.event.preventDefault,d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0),n.fixed=!0},nodeDragged:function(n){var t,r;return i=n.self.a,n.x+=d3.event.dx,n.y+=d3.event.dy,n.px+=d3.event.dx,n.py+=d3.event.dy,r=d3.select(this),r.attr("transform","translate("+n.x+", "+n.y+")"),t=n.self._adjacentEdges,_.each(t,function(n){var t;return t=i.vis.select("#edge-"+n.id+"-"+n._index),i._drawEdges.updateEdge(t.data()[0])})},nodeDragended:function(n){return i=n.self.a,d3.select(this).classed({dragging:!1}),i.conf.forceLocked?void 0:i.force.start()},nodeDoubleClick:function(){return null},deselectAll:function(){var t;if(i=n.prototype.getInst(this),(t=d3.event)!=null?!t.defaultPrevented:!void 0)return i.conf.showEditor===!0&&i.modifyElements.nodeEditorClear(),_.each(i._nodes,function(n){return n._state="active",n.setStyles()}),_.each(i._edges,function(n){return _.each(n,function(n){return n._state="active",n.setStyles()})}),i.conf.deselectAll&&typeof(i.conf.deselectAll==="function")?i.conf.deselectAll():void 0}}};f=function(){function n(n){this.tick=t(this.tick,this);this.linkStrength=t(this.linkStrength,this);this.gravity=t(this.gravity,this);var u,i,r;this.a=u=n;i=this.a.conf;r=this.a._nodes;this.k=Math.sqrt(Math.log(_.size(this.a._nodes))/(i.graphWidth()*i.graphHeight()));this._clustering=new this.a.clustering(this.a);this.d3NodeInternals=u.elements.nodes.d3;i.cluster?(this._charge=function(){return this._clustering.layout.charge},this._linkStrength=function(n){return this._clustering.layout.linkStrength(n)}):(this._charge=function(){return-10/this.k},this._linkStrength=function(n){return r[n.source.id].getProperties("root")||r[n.target.id].getProperties("root")?1:.9});i.cluster?this._linkDistancefn=function(n){return this._clustering.layout.linkDistancefn(n)}:i.linkDistancefn==="default"?this._linkDistancefn=function(){return 1/(this.k*50)}:typeof i.linkDistancefn=="number"?this._linkDistancefn=function(){return i.linkDistancefn}:typeof i.linkDistancefn=="function"&&(this._linkDistancefn=function(n){return i.linkDistancefn(n)})}return n.prototype.gravity=function(){return this.a.conf.cluster?this._clustering.layout.gravity(this.k):50*this.k},n.prototype.linkStrength=function(n){return this._linkStrength(n)},n.prototype.friction=function(){return.9},n.prototype.collide=function(n){var i,r,u,f,e,t;return i=this.a.conf,t=2*(n.radius+n["stroke-width"])+i.nodeOverlap,r=n.x-t,u=n.x+t,f=n.y-t,e=n.y+t,function(o,s,h,c,l){var a,v,y;return o.point&&o.point!==n&&(v=n.x-Math.abs(o.point.x),y=n.y-o.point.y,a=Math.sqrt(v*v+y*y),t=t,a<t&&(a=(a-t)/a*i.alpha,n.x-=v*=a,n.y-=y*=a,o.point.x+=v,o.point.y+=y)),s>u||c<r||h>e||l<f}},n.prototype.tick=function(){var n,i,u,f,e,t,o,r;if(n=this.a,f=n.elements.nodes.svg,i=n.elements.edges.svg,n.conf.collisionDetection)for(e=d3.geom.quadtree(this.d3NodeInternals),r=this.d3NodeInternals,t=0,o=r.length;t<o;t++)u=r[t],e.visit(this.collide(u));return f.attr("transform",function(n){return"translate("+n.x+","+n.y+")"}),this.drawEdge=n.drawing.DrawEdge,this.drawEdge.styleText(i),this.drawEdge.styleLink(i)},n.prototype.positionRootNodes=function(){var u,t,r,n,i,f,h,e,o,s;if(u=this.a.conf,t={width:u.graphWidth(),height:u.graphHeight()},i=_.filter(this.a.elements.nodes.val,function(n){return n.getProperties("root")}),i.length===1)n=i[0],e=[t.width/2,t.width/2],n._d3.x=e[0],n._d3.px=e[1],o=[t.height/2,t.height/2],n._d3.y=o[0],n._d3.py=o[1],n._d3.fixed=!0;else{for(s=[],r=f=0,h=i.length;f<h;r=++f)n=i[r],n._d3.x=t.width/Math.sqrt(i.length*(r+1)),n._d3.y=t.height/2,s.push(n._d3.fixed=!0);return s}},n.prototype.chargeDistance=function(){return 500},n.prototype.linkDistancefn=function(n){return this._linkDistancefn(n)},n.prototype.charge=function(){return this._charge()},n}();n.prototype.generateLayout=function(n){var t;return t=n,function(n){var i;return n==null&&(n=!1),i=t.conf,t.layout=new f(t),t.force=d3.layout.force().size([i.graphWidth(),i.graphHeight()]).theta(1).gravity(t.layout.gravity()).friction(t.layout.friction()).nodes(t.elements.nodes.d3).links(t.elements.edges.d3).linkDistance(function(n){return t.layout.linkDistancefn(n)}).linkStrength(function(n){return t.layout.linkStrength(n)}).charge(t.layout.charge()).chargeDistance(t.layout.chargeDistance())}};n.prototype.search=function(n){var t;return t=n,{init:function(){var n=t.dash.select("#search input");return n.on("keyup",function(){var i;return i=n[0][0].value.toLowerCase(),t.vis.selectAll(".node").classed("inactive",!1),t.vis.selectAll("text").attr("style",function(){if(i!=="")return"display: inline;"}),t.vis.selectAll(".node").classed("inactive",function(n){var u,r;u=d3.select(this).text();switch(t.conf.searchMethod){case"contains":r=u.toLowerCase().indexOf(i)<0;break;case"begins":r=u.toLowerCase().indexOf(i)!==0}return r?t.vis.selectAll("[source-target*='"+n.id+"']").classed("inactive",r):t.vis.selectAll("[source-target*='"+n.id+"']").classed("inactive",function(n){var i,r,u;return i=[n.source.id,n.target.id],r=t.vis.select("#node-"+i[0]).classed("inactive"),u=t.vis.select("#node-"+i[1]).classed("inactive"),u||r}),r})})}}};n.prototype.startGraph=function(t){var i;return i=t,function(t){var r,u,f,s,e,o;if(r=i.conf,d3.select(r.divSelector).empty()&&console.warn(i.utils.warnings.divWarning()),t||(t={nodes:[],edges:[]},i.utils.warnings.dataWarning()),t.edges==null&&(t.edges=[]),i.create.nodes(t.nodes),t.edges.forEach(function(n){return i.create.edges(n)}),i.vis=d3.select(r.divSelector).attr("style","width:"+r.graphWidth()+"px; height:"+r.graphHeight()+"px; background:"+r.backgroundColour+";").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xlink","http://www.w3.org/1999/xlink").attr("pointer-events","all").attr("style","background:"+r.backgroundColour+";").attr("alchInst",n.prototype.instances.length-1).on("click",i.interactions.deselectAll).call(i.interactions.zoom(r.scaleExtent)).on("dblclick.zoom",null).append("g").attr("transform","translate("+r.initialTranslate+") scale("+r.initialScale+")"),i.interactions.zoom().scale(r.initialScale),i.interactions.zoom().translate(r.initialTranslate),i.index=n.prototype.Index(i),i.generateLayout(),i.controlDash.init(),u=i.elements.edges.d3,f=i.elements.nodes.d3,i.layout.positionRootNodes(),i.force.start(),r.forceLocked)while(i.force.alpha()>.005)i.force.tick();if(i._drawEdges=i.drawing.DrawEdges,i._drawNodes=i.drawing.DrawNodes,i._drawEdges.createEdge(u),i._drawNodes.createNode(f),i.index(),i.elements.nodes.svg.attr("transform",function(n){return"translate("+n.x+", "+n.y+")"}),console.log(Date()+" completed initial computation"),r.forceLocked||i.force.on("tick",i.layout.tick).start(),r.afterLoad!=null&&(typeof r.afterLoad=="function"?r.afterLoad():typeof r.afterLoad=="string"&&(i[r.afterLoad]=!0)),r.cluster&&(s=d3.select(""+i.conf.divSelector+" svg").append("svg:defs")),r.nodeStats&&i.stats.nodeStats(),r.showEditor){e=new i.editor.Editor;o=new i.editor.Interactions;d3.select("body").on("keydown",o.deleteSelected);e.startEditor()}return i.initial=!0}};n.prototype.stats=function(n){var t;return t=n,{init:function(){return t.stats.update()},nodeStats:function(){var u,f,e,l,o,a,v,s,i,n,h,r,y,c;if(o=[],f=t.get.allNodes().length,u=t.get.activeNodes().length,l=f-u,i="<li class = 'list-group-item gen_node_stat'>Number of nodes: <span class='badge'>"+f+"<\/span><\/li> <li class = 'list-group-item gen_node_stat'>Number of active nodes: <span class='badge'>"+u+"<\/span><\/li> <li class = 'list-group-item gen_node_stat'>Number of inactive nodes: <span class='badge'>"+l+"<\/span><\/li><\/br>",t.conf.nodeTypes){for(v=Object.keys(t.conf.nodeTypes),h="",c=t.conf.nodeTypes[v],r=0,y=c.length;r<y;r++)n=c[r],e=n.replace("_"," "),s=t.vis.selectAll("g.node."+n)[0].length,h+="<li class = 'list-group-item nodeType' id='li-"+n+"' name = "+e+">Number of <strong style='text-transform: uppercase'>"+e+"<\/strong> nodes: <span class='badge'>"+s+"<\/span><\/li>",o.push([""+n,s]);i+=h}return a="<li id='node-stats-graph' class='list-group-item'><\/li>",i+=a,t.dash.select("#node-stats").html(i),this.insertSVG("node",o)},edgeStats:function(){var f,e,i,o,l,s,h,r,n,c,a,u,v;if(o=[],e=t.get.allEdges().length,f=t.get.activeEdges().length,a=e-f,r="<li class = 'list-group-item gen_edge_stat'>Number of relationships: <span class='badge'>"+e+"<\/span><\/li> <li class = 'list-group-item gen_edge_stat'>Number of active relationships: <span class='badge'>"+f+"<\/span><\/li> <li class = 'list-group-item gen_edge_stat'>Number of inactive relationships: <span class='badge'>"+a+"<\/span><\/li><\/br>",t.conf.edgeTypes){for(s=_.values(alchemy.conf.edgeTypes)[0],c="",u=0,v=s.length;u<v;u++)(n=s[u],n)&&(i=n.replace("_"," "),h=_.filter(t.get.allEdges(),function(t){if(t._edgeType===n)return t}).length,c+="<li class = 'list-group-item edgeType' id='li-"+n+"' name = "+i+">Number of <strong style='text-transform: uppercase'>"+i+"<\/strong> relationships: <span class='badge'>"+h+"<\/span><\/li>",o.push([""+i,h]));r+=c}return l="<li id='node-stats-graph' class='list-group-item'><\/li>",r+=l,t.dash.select("#rel-stats").html(r),this.insertSVG("edge",o)},insertSVG:function(n,i){var u,f,s,e,h,o,c,r;return i===null?t.dash.select("#"+n+"-stats-graph").html("<br><h4 class='no-data'>There are no "+n+"Types listed in your conf.<\/h4>"):(r=t.conf.graphWidth()*.25,e=250,o=r/4,s=d3.scale.category20(),u=d3.svg.arc().outerRadius(o-10).innerRadius(o/2),h=d3.layout.pie().sort(null).value(function(n){return n[1]}),c=t.dash.select("#"+n+"-stats-graph").append("svg").append("g").style({width:r,height:e}).attr("transform","translate("+r/2+","+e/2+")"),f=c.selectAll(".arc").data(h(i)).enter().append("g").classed("arc",!0).on("mouseover",function(n,r){return t.dash.select("#"+i[r][0]+"-stat").classed("hidden",!1)}).on("mouseout",function(n,r){return t.dash.select("#"+i[r][0]+"-stat").classed("hidden",!0)}),f.append("path").attr("d",u).attr("stroke",function(n,t){return s(t)}).attr("stroke-width",2).attr("fill-opacity","0.3"),f.append("text").attr("transform",function(n){return"translate("+u.centroid(n)+")"}).attr("id",function(n,t){return""+i[t][0]+"-stat"}).attr("dy",".35em").classed("hidden",!0).text(function(n,t){return i[t][0]}))},update:function(){return t.conf.nodeStats&&this.nodeStats(),t.conf.edgeStats?this.edgeStats():void 0}}};n.prototype.updateGraph=function(n){var t;return t=n,function(){for(t.generateLayout(),t._drawEdges.createEdge(t.elements.edges.d3),t._drawNodes.createNode(t.elements.nodes.d3),t.index(),t.layout.positionRootNodes(),t.force.start();t.force.alpha()>.005;)t.force.tick();return t.force.on("tick",t.layout.tick).start(),t.elements.nodes.svg.attr("transform",function(n){return"translate("+n.x+", "+n.y+")"})}};n.prototype.defaults={plugins:null,renderer:"svg",graphWidth:function(){return d3.select(this.divSelector).node().parentElement.clientWidth},graphHeight:function(){return d3.select(this.divSelector).node().parentElement.nodeName==="BODY"?window.innerHeight:d3.select(this.divSelector).node().parentElement.clientHeight},alpha:.5,collisionDetection:!0,nodeOverlap:25,fixNodes:!1,fixRootNodes:!1,forceLocked:!0,linkDistancefn:"default",nodePositions:null,showEditor:!1,captionToggle:!1,toggleRootNodes:!1,removeElement:!1,cluster:!1,clusterKey:"cluster",clusterColours:d3.shuffle(["#DD79FF","#FFFC00","#00FF30","#5168FF","#00C0FF","#FF004B","#00CDCD","#f83f00","#f800df","#ff8d8f","#ffcd00","#184fff","#ff7e00"]),clusterControl:!1,nodeStats:!1,edgeStats:!1,edgeFilters:!1,nodeFilters:!1,edgesToggle:!1,nodesToggle:!1,zoomControls:!1,nodeCaption:"caption",nodeCaptionsOnByDefault:!1,nodeStyle:{all:{radius:10,color:"#68B9FE",borderColor:"#127DC1",borderWidth:function(n,t){return t/3},captionColor:"#FFFFFF",captionBackground:null,captionSize:12,selected:{color:"#FFFFFF",borderColor:"#349FE3"},highlighted:{color:"#EEEEFF"},hidden:{color:"none",borderColor:"none"}}},nodeColour:null,nodeMouseOver:"caption",nodeRadius:10,nodeTypes:null,rootNodes:"root",rootNodeRadius:15,nodeClick:null,nodePadding:0,edgeCaption:"caption",edgeCaptionsOnByDefault:!1,edgeStyle:{all:{width:4,color:"#CCC",opacity:.2,directed:!0,curved:!0,selected:{opacity:1},highlighted:{opacity:1},hidden:{opacity:0}}},edgeTypes:null,curvedEdges:!1,edgeWidth:function(){return 4},edgeOverlayWidth:20,directedEdges:!1,edgeArrowSize:5,edgeClick:null,search:!1,searchMethod:"contains",backgroundColour:"#000000",theme:null,afterLoad:"afterLoad",divSelector:"#alchemy",dataSource:null,initialScale:1,initialTranslate:[0,0],scaleExtent:[.5,2.4],exportSVG:!1,dataWarning:"default",warningMessage:"There be no data!  What's going on?"};o=function(n){return{a:n,createLink:function(n){var t;return t=this.a.conf,n.append("path").attr("class","edge-line").attr("id",function(n){return"path-"+n.id}),n.filter(function(n){return n.caption!=null}).append("text").append("textPath").classed("textpath",!0)},triangle:function(n){var t,r,i;return i=n.target.x-n.source.x,t=n.target.y-n.source.y,r=Math.sqrt(t*t+i*i),[i,t,r]},edgeData:function(n){var i,r,u,f,e,o,s,t;return t=this.triangle(n),s=t[0],f=t[1],e=t[2],u=n["stroke-width"],i=2,o=n.source.radius+n.source["stroke-width"]-u/2+i,r=e-o-i*1.5,{edgeAngle:Math.atan2(f,s)/Math.PI*180,edgeLength:r}},edgeAngle:function(n){var t,i;return i=n.target.x-n.source.x,t=n.target.y-n.source.y,Math.atan2(t,i)/Math.PI*180},edgeStyle:function(n){var t,u,f,i,r;return u=this.a.conf,f=this.a._edges[n.id][n.pos],r=this.a.svgStyles.edge.populate(f),i=this.a._nodes,this.a.conf.cluster&&(t=this.a.layout._clustering,r.stroke=function(n){var r,s,h,o,f,e;return(r=u.clusterKey,f=i[n.source.id]._properties,e=i[n.target.id]._properties,f.root||e.root)?(o=f.root?e[r]:f[r],""+t.getClusterColour(o)):f[r]===e[r]?(o=f[r],""+t.getClusterColour(o)):f[r]!==e[r]?(h=""+f[r]+"-"+e[r],s="cluster-gradient-"+h,"url(#"+s+")"):void 0}(n)),r},edgeWalk:function(n){var it,rt,pt,r,ut,wt,o,bt,ft,kt,et,dt,gt,d,ni,s,c,ti,ot,l,v,ri,y,a,p,st,u,w,ht,ct,f,lt,i,at,vt,t,h,e,b,k,ii,ui,yt,g,nt,tt;return r=this.a,t=function(n){return n*n},at=n.source,yt=n.target,r.conf.curvedEdges?(f=r.conf.edgeWidth()*1.7,bt=r.conf.edgeWidth()*.6,i=bt/2,w=i*2.4,u=r.conf.directedEdges?w*2:.0001,nt=n.source.x-n.target.x,tt=n.source.y-n.target.y,ni=Math.sqrt(t(nt)+t(tt)),ii=0,ui=0,b=n.source.radius,v=ni,ri=0,ot=n.target.radius,gt=v-ii,lt=(b+f)/(ot+u+f),ht=-gt*lt/(1-lt),wt=1.5,ut=wt*w*2/b,h=Math.cos(ut)*(b+f),e=Math.sin(ut)*(b+f),p=e/(h-ht),st=e-p*h,ct=v,it=1+t(p),rt=2*(p*st-ct),pt=t(st)+t(ct)-t(ot+u+f),s=(-rt-Math.sqrt(t(rt)-4*it*pt))/(2*it),c=(s-ht)*p,y=-h/e,ft=e+t(h)/e,a=-(s-v)/c,kt=c+(s-v)*s/c,et=(ft-kt)/(a-y),dt=y*et+ft,o=Math.sqrt(t(et-h)+t(dt-e)),k=function(n){var i,r,u;return u=n<0?-1:1,i=u*Math.sqrt(t(n)/(1+t(y))),r=y*i,""+(h+i)+", "+(e+r)},l=function(n){var i,r,u;return u=n<0?-1:1,i=u*Math.sqrt(t(n)/(1+t(a))),r=a*i,""+(s+i)+", "+(c+r)},ti=function(n){var i,r,u;return u=n<0?-1:1,i=u*Math.sqrt(t(n)/(1+t(1/a))),r=i/a,""+(s+i)+", "+(c-r)},r.conf.directedEdges?"M "+k(-i)+" L "+k(i)+" A "+(o-i)+", "+(o-i)+" 0 0 0 "+l(-i)+" L "+l(-w)+" L "+ti(u)+" L "+l(w)+" L "+l(i)+" A "+(o+i)+", "+(o+i)+" 0 0 1 "+k(-i)+" Z":"M "+k(-i)+" A "+(o-i)+", "+(o-i)+" 0 0 0 "+l(-i)):(f=r.conf.nodePadding,vt=at.radius+f+at["stroke-width"]/2,g=yt.radius+f+yt["stroke-width"]/2,nt=n.source.x-n.target.x,tt=n.source.y-n.target.y,d=Math.sqrt(t(nt)+t(tt)),r.conf.directedEdges?(u=r.conf.edgeWidth()*2.4,"M "+vt+" 0 L "+(d-g-u)+" 0 l 0 2 l "+u/2+" -2 l "+-u/2+" -2 L "+(d-g-u)+" 0"):"M "+vt+" 0 L "+(d-g)+" 0")},styleLink:function(n){var i,r,t;return i=this.a,r=i.conf,t=i.drawing.DrawEdge,n.each(function(n){var u,r;return r=d3.select(this),u=t.edgeData(n),r.attr("transform","translate("+n.source.x+", "+n.source.y+") rotate("+t.edgeAngle(n)+")"),r.select(".edge-line").attr("d",function(){return t.edgeWalk(n)}()).attr("stroke-width",function(){return i.conf.edgeWidth}()).style(t.edgeStyle(n))})},classEdge:function(n){return n.classed("active",!0)},styleText:function(n){var t;return t=this.a.conf,n.select("text").each(function(n){var i,r,u,f,e;return f=n.source.x-n.target.x,e=n.source.y-n.target.y,u=Math.sqrt(Math.pow(f,2)+Math.pow(e,2)),({captionAngle:function(n){return n<-90||n>90?180:0}}),i=u/2,r=-n["stroke-width"]*2,d3.select(this).attr("dx",""+i).attr("dy",""+r).select(".textpath").text(n.caption).attr("xlink:xlink:href","#path-"+n.source.id+"-"+n.target.id).style("display",function(){if(t.edgeCaptionsOnByDefault)return"block"})})},setInteractions:function(n){var t=this.a.interactions;return n.on("click",t.edgeClick).on("mouseover",function(n){return t.edgeMouseOver(n)}).on("mouseout",function(n){return t.edgeMouseOut(n)})}}};s=function(n){return{a:n,createEdge:function(n){var t,i;return i=this.a.drawing.DrawEdge,t=this.a.vis.selectAll("g.edge").data(n),t.enter().append("g").attr("id",function(n){return"edge-"+n.id+"-"+n.pos}).attr("class",function(n){return"edge "+n.edgeType}).attr("source-target",function(n){return""+n.source.id+"-"+n.target.id}),i.createLink(t),i.classEdge(t),i.styleLink(t),i.styleText(t),i.setInteractions(t),t.exit().remove()},updateEdge:function(n){var t,i;return t=this.a.drawing.DrawEdge,i=this.a.vis.select("#edge-"+n.id+"-"+n.pos),t.classEdge(i),t.styleLink(i),t.styleText(i),t.setInteractions(i)}}};h=function(n){return{a:n,styleText:function(n){var t,i,r;return t=this.a.conf,r=this.a.drawing.NodeUtils,i=this.a._nodes,n.selectAll("text").attr("dy",function(n){return i[n.id].getProperties().root?t.rootNodeRadius/2:t.nodeRadius*2-5}).attr("visibility",function(n){return i[n.id]._state==="hidden"?"hidden":"visible"}).text(function(n){return r.nodeText(n)}).style("display",function(){if(t.nodeCaptionsOnByDefault)return"block"})},createNode:function(n){return n=_.difference(n,n.select("circle").data()),n.__proto__=d3.select().__proto__,n.append("circle").attr("id",function(n){return"circle-"+n.id}),n.append("svg:text").attr("id",function(n){return"text-"+n.id})},styleNode:function(n){var t;return t=this.a.drawing.NodeUtils,n.selectAll("circle").attr("r",function(n){return typeof n.radius=="function"?n.radius():n.radius}).each(function(n){return d3.select(this).style(t.nodeStyle(n))})},setInteractions:function(n){var u,t,r,f,i,e,o;if(u=this.a.conf,t=this.a.interactions,f=this.a.get.state("interactions")==="editor",r=d3.behavior.drag().origin(Object).on("dragstart",null).on("drag",null).on("dragend",null),f){i=new this.a.editor.Interactions;return n.on("mouseup",function(n){return i.nodeMouseUp(n)}).on("mouseover",function(n){return i.nodeMouseOver(n)}).on("mouseout",function(n){return i.nodeMouseOut(n)}).on("dblclick",function(n){return t.nodeDoubleClick(n)}).on("click",function(n){return i.nodeClick(n)})}n.on("mouseup",null).on("mouseover",function(n){return t.nodeMouseOver(n)}).on("mouseout",function(n){return t.nodeMouseOut(n)}).on("dblclick",function(n){return t.nodeDoubleClick(n)}).on("click",function(n){return t.nodeClick(n)});if(r=d3.behavior.drag().origin(Object).on("dragstart",t.nodeDragStarted).on("drag",t.nodeDragged).on("dragend",t.nodeDragended),u.fixNodes||(e=n.filter(function(n){return n.root!==!0}),e.call(r)),!u.fixRootNodes)return o=n.filter(function(n){return n.root===!0}),o.call(r)}}};c=function(n){return{a:n,createNode:function(n){var i,t;return i=this.a.drawing.DrawNode,t=this.a.vis.selectAll("g.node").data(n,function(n){return n.id}),t.enter().append("g").attr("class",function(n){var t;return t=n.self._nodeType,"node "+t+" active"}).attr("id",function(n){return"node-"+n.id}).classed("root",function(n){return n.root}),i.createNode(t),i.styleNode(t),i.styleText(t),i.setInteractions(t),t.exit().remove()},updateNode:function(n){var t,i;return t=this.a.drawing.DrawNode,i=this.a.vis.select("#node-"+n.id),t.styleNode(i),t.styleText(i),t.setInteractions(i)}}};n.prototype.NodeUtils=function(n){var t;return t=n,{nodeStyle:function(n){var i,r;return i=t.conf,r=n.self,i.cluster&&r._state!=="hidden"&&(n.fill=function(){var u,f,e,o,n,s,h;return f=t.layout._clustering,h=r.getProperties(),u=f.clusterMap,s=i.clusterKey,n=i.clusterColours,o=u[h[s]]%n.length,e=n[o],""+e}(n),n.stroke=n.fill),n},nodeText:function(n){var r,i,u;return(i=t.conf,u=t._nodes[n.id]._properties,i.nodeCaption&&typeof i.nodeCaption=="string")?u[i.nodeCaption]!=null?u[i.nodeCaption]:"":i.nodeCaption&&typeof i.nodeCaption=="function"?(r=i.nodeCaption(u),(r===void 0||String(r)==="undefined")&&(t.log.caption="At least one caption returned undefined",i.caption=!1),r):void 0}}};n.prototype.svgStyles=function(n){return{a:n,node:{a:this.a,populate:function(n){var t,i,s,h,u,c,o,l,a,f,r,e,v;return t=this.a.conf,s=_.omit(t.nodeStyle.all,"selected","highlighted","hidden"),i=n,e=function(n){return typeof n=="function"?n:function(){return n}},c=_.keys(t.nodeTypes)[0],u=n.getProperties()[c],t.nodeStyle[u]===void 0&&(u="all"),v=_.assign(_.cloneDeep(s),t.nodeStyle[u]),f=_.assign(v,t.nodeStyle[u][n._state]),o=e(f.radius),h=e(f.color),l=e(f.borderColor),a=e(f.borderWidth),r={},r.radius=o(i),r.fill=h(i),r.stroke=l(i),r["stroke-width"]=a(i,o(i)),r}},edge:{a:this.a,populate:function(n){var f,t,e,i,o,r,u,s,h;return t=this.a.conf,e=_.omit(t.edgeStyle.all,"selected","highlighted","hidden"),u=function(n){return typeof n=="function"?n:function(){return n}},i=n._edgeType,t.edgeStyle[i]===void 0&&(i="all"),s=_.assign(_.cloneDeep(e),t.edgeStyle[i]),r=_.assign(s,t.edgeStyle[i][n._state]),h=u(r.width),f=u(r.color),o=u(r.opacity),{stroke:f(n),"stroke-width":h(n),opacity:o(n),fill:"none"}},update:function(n){var r,e,u,t,i,f;return e=this.a.conf,t=n._style,i=function(n){return typeof n=="function"?n:function(){return n}},f=i(t.width),r=i(t.color),u=i(t.opacity),{stroke:r(n),"stroke-width":f(n),opacity:u(n),fill:"none"}}}}};v=function(){function n(){this.nodeEditor=t(this.nodeEditor,this);this.startEditor=t(this.startEditor,this);this.utils=new alchemy.editor.Utils}return n.prototype.editorContainerHTML='<div id="editor-header" data-toggle="collapse" data-target="#editor #element-options">\n    <h3>Editor<\/h3><span class="fa fa-2x fa-caret-right"><\/span>\n<\/div>\n<div id="element-options" class="collapse">\n    <ul class="list-group"> \n        <li class="list-group-item" id="remove">Remove Selected<\/li> \n        <li class="list-group-item" id="editor-interactions">Editor mode enabled, click to disable editor interactions<\/li>\n    <\/ul>\n<\/div>',n.prototype.elementEditorHTML=function(n){return"<h4>"+n+' Editor<\/h4>\n<form id="add-property-form">\n    <div id="add-property">\n        <input class="form-control" id="add-prop-key" placeholder="New Property Name">\n        <input class="form-control" id="add-prop-value" placeholder="New Property Value">\n    <\/div>\n    <input id="add-prop-submit" type="submit" value="Add Property" placeholder="add a property to this node">\n<\/form>\n<form id="properties-list">\n    <input id="update-properties" type="submit" value="Update Properties">\n<\/form>'},n.prototype.startEditor=function(){var u,n,i,r,t;u=alchemy.conf.divSelector;r=this.editorContainerHTML;n=alchemy.dash.select("#control-dash").append("div").attr("id","editor").html(r);n.select("#editor-header").on("click",function(){return alchemy.dash.select("#element-options").classed("in")?alchemy.dash.select("#editor-header>span").attr("class","fa fa-2x fa-caret-right"):alchemy.dash.select("#editor-header>span").attr("class","fa fa-2x fa-caret-down")});i=n.select("#element-options ul #editor-interactions").on("click",function(){return d3.select(this).attr("class",function(){return alchemy.get.state()==="editor"?(alchemy.set.state("interactions","default"),"inactive list-group-item"):(alchemy.set.state("interactions","editor"),"active list-group-item")}).html(function(){return alchemy.get.state()==="editor"?"Disable Editor Interactions":"Enable Editor Interactions"})});n.select("#element-options ul #remove").on("click",function(){return alchemy.editor.remove()});t=this.utils;return i.on("click",function(){return alchemy.dash.select("#editor-interactions").classed("active")?(t.disableEditor(),alchemy.dash.select("#editor-interactions").classed({active:!1,inactive:!0}).html("Editor mode disabled, click to enable editor interactions")):(t.enableEditor(),alchemy.dash.select("#editor-interactions").classed({active:!0,inactive:!1}).html("Editor mode enabled, click to disable editor interactions"))})},n.prototype.nodeEditor=function(n){var r,a,i,o,s,u,f,h,t,c,e,l;a=alchemy.conf.divSelector;i=alchemy.dash.select("#control-dash #editor");h=i.select("#element-options");s=this.elementEditorHTML("Node");o=h.append("div").attr("id","node-editor").html(s);o.attr("class",function(){var n;return(n=alchemy.dash.select("#editor-interactions").classed("active"),n)?"enabled":"hidden"});r=i.select("#node-editor form #add-property");r.select("#node-add-prop-key").attr("placeholder","New Property Name").attr("value",null);r.select("#node-add-prop-value").attr("placeholder","New Property Value").attr("value",null);alchemy.dash.select("#add-property-form").on("submit",function(){var n,t;return event.preventDefault(),n=alchemy.dash.select("#add-prop-key").property("value"),n=n.replace(/\s/g,"_"),t=alchemy.dash.select("#add-prop-value").property("value"),e(n,t,!0),alchemy.dash.selectAll("#add-property .edited-property").classed({"edited-property":!1}),this.reset()});u=alchemy._nodes[n.id].getProperties();alchemy.vis.select("#node-"+n.id).classed({editing:!0});c=i.select("#node-editor #properties-list");for(t in u)l=u[t],f=c.append("div").attr("id","node-"+t).attr("class","property form-inline form-group"),f.append("label").attr("for","node-"+t+"-input").attr("class","form-control property-name").text(""+t),f.append("input").attr("id","node-"+t+"-input").attr("class","form-control property-value").attr("value",""+l);alchemy.dash.select("#properties-list").on("submit",function(){var u,f,i,o,n,s,r;for(event.preventDefault(),f=alchemy.dash.selectAll(".edited-property"),r=f[0],n=0,s=r.length;n<s;n++)t=r[n],i=alchemy.dash.select(t),u=i.select("label").text(),o=i.select("input").attr("value"),e(u,o,!1);return alchemy.dash.selectAll("#node-properties-list .edited-property").classed({"edited-property":!1}),this.reset()});d3.selectAll("#add-prop-key, #add-prop-value, .property").on("keydown",function(){return d3.event.keyCode===13&&event.preventDefault(),d3.select(this).classed({"edited-property":!0})});return e=function(t,i,r){var f,u;return u=n.id,t!==""&&i!==""?(alchemy._nodes[u].setProperty(""+t,""+i),f=alchemy._drawNodes,f.updateNode(alchemy.viz.select("#node-"+u)),r===!0?(alchemy.dash.select("#node-add-prop-key").attr("value","property added/updated to key: "+t),alchemy.dash.select("#node-add-prop-value").attr("value","property at "+t+" updated to: "+i)):alchemy.dash.select("#node-"+t+"-input").attr("value","property at "+t+" updated to: "+i)):r===!0?(alchemy.dash.select("#node-add-prop-key").attr("value","null or invalid input"),alchemy.dash.select("#node-add-prop-value").attr("value","null or invlid input")):alchemy.dash.select("#node-"+t+"-input").attr("value","null or invalid input")}},n.prototype.editorClear=function(){return alchemy.dash.selectAll(".node").classed({editing:!1}),alchemy.dash.selectAll(".edge").classed({editing:!1}),alchemy.dash.select("#node-editor").remove(),alchemy.dash.select("#edge-editor").remove(),alchemy.dash.select("#node-add-prop-submit").attr("placeholder",function(){return alchemy.vis.selectAll(".selected").empty()?"select a node or edge to edit properties":"add a property to this element"})},n.prototype.edgeEditor=function(n){var r,a,u,f,i,o,s,h,t,c,e,l;a=alchemy.conf.divSelector;i=alchemy.dash("#control-dash #editor");h=i.select("#element-options");s=this.elementEditorHTML("Edge");o=h.append("div").attr("id","edge-editor").html(s);o.attr("class",function(){return alchemy.dash.select("#editor-interactions").classed("active")?"enabled":"hidden"});r=i.select("#edge-editor form #add-property");r.select("#add-prop-key").attr("placeholder","New Property Name").attr("value",null);r.select("#add-prop-value").attr("placeholder","New Property Value").attr("value",null);u=alchemy._edges[n.id].getProperties();alchemy.vis.select("#edge-"+n.id).classed({editing:!0});c=i.select("#edge-editor #properties-list");for(t in u)l=u[t],f=c.append("div").attr("id","edge-"+t).attr("class","property form-inline form-group"),f.append("label").attr("for","edge-"+t+"-input").attr("class","form-control property-name").text(""+t),f.append("input").attr("id","edge-"+t+"-input").attr("class","form-control property-value").attr("value",""+l);alchemy.dash.selectAll("#add-prop-key, #add-prop-value, .property").on("keydown",function(){return d3.event.keyCode===13&&event.preventDefault(),d3.select(this).classed({"edited-property":!0})});alchemy.dash.select("#add-property-form").on("submit",function(){var n,t;return event.preventDefault(),n=alchemy.dash.select("#add-prop-key").property("value"),n=n.replace(/\s/g,"_"),t=alchemy.dash.select("#add-prop-value").property("value"),e(n,t,!0),alchemy.dash.selectAll("#add-property .edited-property").classed({"edited-property":!1}),this.reset()});d3.select("#properties-list").on("submit",function(){var u,f,i,o,n,s,r;for(event.preventDefault(),f=alchemy.dash.selectAll(".edited-property"),r=f[0],n=0,s=r.length;n<s;n++)t=r[n],i=alchemy.dash.select(t),u=i.select("label").text(),o=i.select("input").property("value"),e(u,o,!1);return alchemy.dash.selectAll("#properties-list .edited-property").classed({"edited-property":!1}),this.reset()});return e=function(t,i,r){var f,u,e;return u=n.id,t!==""&&i!==""?(alchemy._edges[u].setProperty(""+t,""+i),e=alchemy.vis.select("#edge-"+u),f=new alchemy.drawing.DrawEdges,f.updateEdge(alchemy.vis.select("#edge-"+u)),r===!0?(alchemy.dash.select("#add-prop-key").attr("value","property added/updated to key: "+t),alchemy.dash.select("#add-prop-value").attr("value","property at "+t+" updated to: "+i)):alchemy.dash.select("#edge-"+t+"-input").attr("value","property at "+t+" updated to: "+i)):r===!0?(alchemy.dash.select("#add-prop-key").attr("value","null or invalid input"),alchemy.dash.select("#add-prop-value").attr("value","null or invlid input")):alchemy.dash.select("#edge-"+t+"-input").attr("value","null or invalid input")}},n}();y=function(){function n(){this.reset=t(this.reset,this);this.deleteSelected=t(this.deleteSelected,this);this.addNodeDragended=t(this.addNodeDragended,this);this.addNodeDragging=t(this.addNodeDragging,this);this.addNodeStart=t(this.addNodeStart,this);this.edgeClick=t(this.edgeClick,this);this.nodeClick=t(this.nodeClick,this);this.nodeMouseUp=t(this.nodeMouseUp,this);this.editor=new alchemy.editor.Editor}return n.prototype.nodeMouseOver=function(){var n;return d3.select(this).select("circle").empty()||(n=d3.select(this).select("circle").attr("r"),d3.select(this).select("circle").attr("r",n*3)),this},n.prototype.nodeMouseUp=function(n){return this.sourceNode!==n?(this.mouseUpNode=!0,this.targetNode=n,this.click=!1):this.click=!0,this},n.prototype.nodeMouseOut=function(){var n;return d3.select(this).select("circle").empty()||(n=d3.select(this).select("circle").attr("r"),d3.select(this).select("circle").attr("r",n/3)),this},n.prototype.nodeClick=function(n){var t;return d3.event.stopPropagation(),alchemy.vis.select("#node-"+n.id).empty()||(t=alchemy.vis.select("#node-"+n.id).classed("selected"),alchemy.vis.select("#node-"+n.id).classed("selected",!t)),this.editor.editorClear(),this.editor.nodeEditor(n)},n.prototype.edgeClick=function(n){return d3.event.stopPropagation(),this.editor.editorClear(),this.editor.edgeEditor(n)},n.prototype.addNodeStart=function(n){return d3.event.sourceEvent.stopPropagation(),this.sourceNode=n,alchemy.vis.select("#dragline").classed({hidden:!1}),this},n.prototype.addNodeDragging=function(){var n,t;return n=d3.event.x,t=d3.event.y,alchemy.vis.select("#dragline").attr("x1",this.sourceNode.x).attr("y1",this.sourceNode.y).attr("x2",n).attr("y2",t).attr("style","stroke: #FFF"),this},n.prototype.addNodeDragended=function(){var n,t,i;return this.click||(this.mouseUpNode||(n=alchemy.vis.select("#dragline"),t=n.attr("x2"),i=n.attr("y2"),this.targetNode={id:""+_.uniqueId("addedNode_"),x:parseFloat(t),y:parseFloat(i),caption:"node added"}),this.newEdge={id:""+this.sourceNode.id+"-"+this.targetNode.id,source:this.sourceNode.id,target:this.targetNode.id,caption:"edited"},alchemy.editor.update(this.targetNode,this.newEdge)),this.reset(),this},n.prototype.deleteSelected=function(){switch(d3.event.keyCode){case 8:case 46:if(!(d3.select(d3.event.target).node().tagName==="INPUT"))return d3.event.preventDefault(),alchemy.editor.remove()}},n.prototype.reset=function(){return this.mouseUpNode=null,this.sourceNode=null,this.targetNode=null,this.newEdge=null,this.click=null,alchemy.vis.select("#dragline").classed({hidden:!0}).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0),this},n,n}();p=function(){function n(){this.enableEditor=t(this.enableEditor,this);this.drawNodes=alchemy._drawNodes;this.drawEdges=alchemy._drawEdges}return n.prototype.enableEditor=function(){var i,t,n;return(alchemy.set.state("interactions","editor"),i=alchemy.vis.append("line").attr("id","dragline"),this.drawNodes.updateNode(alchemy.node),this.drawEdges.updateEdge(alchemy.edge),n=alchemy.vis.selectAll(".selected"),t=new alchemy.editor.Editor,n.empty()||n.length!==1)?n.classed({selected:!1}):n.classed("node")?(t.nodeEditor(n.datum()),alchemy.dash.select("#node-editor").attr("class","enabled").style("opacity",1)):n.classed("edge")?(t.edgeEditor(n.datum()),alchemy.dash.select("#edge-editor").attr("class","enabled").style("opacity",1)):void 0},n.prototype.disableEditor=function(){return alchemy.setState("interactions","default"),alchemy.vis.select("#dragline").remove(),alchemy.dash.select("#node-editor").transition().duration(300).style("opacity",0),alchemy.dash.select("#node-editor").transition().delay(300).attr("class","hidden"),this.drawNodes.updateNode(alchemy.node),alchemy.vis.selectAll(".node").classed({selected:!1})},n.prototype.remove=function(){var n,u,f,e,h,i,r,c,l,o,s,t;for(h=alchemy.vis.selectAll(".selected.node"),o=h[0],t=[],i=0,c=o.length;i<c;i++)if(u=o[i],f=alchemy.vis.select(u).data()[0].id,e=alchemy._nodes[f],e!=null){for(s=e.adjacentEdges,r=0,l=s.length;r<l;r++)n=s[r],alchemy._edges=_.omit(alchemy._edges,""+n.id+"-"+n._index),alchemy.edge=alchemy.edge.data(_.map(alchemy._edges,function(n){return n._d3}),function(n){return n.id}),alchemy.vis.select("#edge-"+n.id+"-"+n._index).remove();alchemy._nodes=_.omit(alchemy._nodes,""+f);alchemy.node=alchemy.node.data(_.map(alchemy._nodes,function(n){return n._d3}),function(n){return n.id});alchemy.vis.select(u).remove();alchemy.get.state("interactions")==="editor"?t.push(alchemy.modifyElements.nodeEditorClear()):t.push(void 0)}else t.push(void 0);return t},n.prototype.addNode=function(n){var t;return t=alchemy._nodes[n.id]=new alchemy.models.Node({id:""+n.id}),t.setProperty("caption",n.caption),t.setD3Property("x",n.x),t.setD3Property("y",n.y),alchemy.node=alchemy.node.data(_.map(alchemy._nodes,function(n){return n._d3}),function(n){return n.id})},n.prototype.addEdge=function(n){var t;return t=alchemy._edges[n.id]=new alchemy.models.Edge(n),alchemy.edge=alchemy.edge.data(_.map(alchemy._edges,function(n){return n._d3}),function(n){return n.id})},n.prototype.update=function(n,t){return this.mouseUpNode?(alchemy.editor.addEdge(t),this.drawEdges.createEdge(alchemy.edge)):(alchemy.editor.addNode(n),alchemy.editor.addEdge(t),this.drawEdges.createEdge(alchemy.edge),this.drawNodes.createNode(alchemy.node)),alchemy.layout.tick()},n}();n.prototype.Edge=function(n){return function(){function r(i,r){var u;r==null&&(r=null);this.allNodesActive=t(this.allNodesActive,this);this.setProperties=t(this.setProperties,this);this.getStyles=t(this.getStyles,this);this.setProperties=t(this.setProperties,this);this.getProperties=t(this.getProperties,this);this._setID=t(this._setID,this);this._setD3Properties=t(this._setD3Properties,this);this.a=n;u=this.a.conf;this.id=this._setID(i);this._index=r;this._state="active";this._properties=i;this._edgeType=this._setEdgeType();this._style=u.edgeStyle[this._edgeType]!=null?_.merge(_.clone(u.edgeStyle.all),u.edgeStyle[this._edgeType]):_.clone(u.edgeStyle.all);this._d3=_.merge({id:this.id,pos:this._index,edgeType:this._edgeType,source:this.a._nodes[this._properties.source]._d3,target:this.a._nodes[this._properties.target]._d3,self:this},this.a.svgStyles.edge.populate(this));this._setCaption(i,u);this.a._nodes[""+i.source]._addEdge(this);this.a._nodes[""+i.target]._addEdge(this)}return r.prototype._setD3Properties=function(n){return _.merge(this._d3,n)},r.prototype._setID=function(n){return n.id!=null?n.id:""+n.source+"-"+n.target},r.prototype._setCaption=function(n,t){var i,r;return i=t.edgeCaption,r=function(n){switch(typeof i){case"string":return n[i];case"function":return i(n)}}(n),r?this._d3.caption=r:void 0},r.prototype._setEdgeType=function(){var t,n,i;return t=this.a.conf,t.edgeTypes&&(_.isPlainObject(t.edgeTypes)?(i=Object.keys(this.a.conf.edgeTypes),n=this._properties[i]):_.isArray(t.edgeTypes)?n=this._properties.caption:typeof t.edgeTypes=="string"&&(n=this._properties[t.edgeTypes])),n===void 0&&(n="all"),this._setD3Properties("edgeType",n),n},r.prototype.getProperties=function(){var n,t,r;return n=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],n==null&&(n=null),n==null&&t.length===0?this._properties:t.length!==0?(r=_.union([n],t),_.pick(this._properties,r)):this._properties[n]},r.prototype.setProperties=function(n,t){return t==null&&(t=null),_.isPlainObject(n)?(_.assign(this._properties,n),"source"in n&&this._setD3Properties({source:alchemy._nodes[n.source]._d3}),"target"in n&&this._setD3Properties({target:alchemy._nodes[n.target]._d3})):(this._properties[n]=t,(n==="source"||n==="target")&&this._setD3Properties({property:alchemy._nodes[t]._d3})),this},r.prototype.getStyles=function(){var n,t,r;return(t=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],n=this,t===void 0)?n._style:_.map(arguments,function(t){return n._style[t]})},r.prototype.setProperties=function(n,t){return t==null&&(t=null),_.isPlainObject(n)?(_.assign(this._properties,n),"source"in n&&this._setD3Properties({source:this.a._nodes[n.source]._d3}),"target"in n&&this._setD3Properties({target:this.a._nodes[n.target]._d3})):(this._properties[n]=t,(n==="source"||n==="target")&&this._setD3Properties({property:this.a._nodes[t]._d3})),this},r.prototype.setStyles=function(n,t){return t==null&&(t=null),n===void 0?n=this.a.svgStyles.edge.populate(this):_.isPlainObject(n)?_.assign(this._style,n):this._style[n]=t,this._setD3Properties(this.a.svgStyles.edge.update(this)),this.a._drawEdges.updateEdge(this._d3),this},r.prototype.toggleHidden=function(){return this._state=this._state==="hidden"?"active":"hidden",this.setStyles()},r.prototype.allNodesActive=function(){var n,t,i,r;return n=this._properties.source,i=this._properties.target,t=alchemy.get.nodes(n)[0],r=alchemy.get.nodes(i)[0],t._state==="active"&&r._state==="active"},r.prototype.remove=function(){var n,t;return n=this,delete this.a._edges[n.id],this.a._nodes[n._properties.source]!=null&&_.remove(this.a._nodes[n._properties.source]._adjacentEdges,function(t){if(t.id===n.id)return t}),this.a._nodes[n._properties.target]!=null&&_.remove(this.a._nodes[n._properties.target]._adjacentEdges,function(t){if(t.id===n.id)return t}),this.a.vis.select("#edge-"+n.id+"-"+n._index).remove(),t=_.filter(this.a.force.links(),function(t){if(t.id!==n.id)return t}),this.a.force.links(t)},r}()};n.prototype.Node=function(n){return function(){function r(i){this.getStyles=t(this.getStyles,this);this.setProperty=t(this.setProperty,this);this.getProperties=t(this.getProperties,this);this._setD3Properties=t(this._setD3Properties,this);this._setNodeType=t(this._setNodeType,this);var r;this.a=n;r=this.a.conf;this.id=i.id;this._properties=i;this._d3=_.merge({id:this.id,root:this._properties[r.rootNodes],self:this},this.a.svgStyles.node.populate(this));this._nodeType=this._setNodeType();this._style=r.nodeStyle[this._nodeType]?r.nodeStyle[this._nodeType]:r.nodeStyle.all;this._state="active";this._adjacentEdges=[]}return r.prototype._setNodeType=function(){var n,i,t,r;return n=this.a.conf,n.nodeTypes&&(_.isPlainObject(n.nodeTypes)?(i=Object.keys(this.a.conf.nodeTypes),r=_.values(n.nodeTypes),t=this._properties[i]):typeof n.nodeTypes=="string"&&(t=this._properties[n.nodeTypes])),t===void 0&&(t="all"),this._setD3Properties("nodeType",t),t},r.prototype._setD3Properties=function(n){return _.merge(this._d3,n)},r.prototype._addEdge=function(n){return this._adjacentEdges=_.union(this._adjacentEdges,[n])},r.prototype.getProperties=function(){var n,t,r;return n=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],n==null&&(n=null),n==null&&t.length===0?this._properties:t.length!==0?(r=_.union([n],t),_.pick(this._properties,r)):this._properties[n]},r.prototype.setProperty=function(n,t){return t==null&&(t=null),_.isPlainObject(n)?_.assign(this._properties,n):this._properties[n]=t,this},r.prototype.removeProperty=function(){var t,u,f,n,r;for(f=arguments[0],u=2<=arguments.length?i.call(arguments,1):[],n=0,r=arguments.length;n<r;n++)t=arguments[n],delete this._properties[t];return this},r.prototype.getStyles=function(){var t,r,n;return(t=arguments[0],r=2<=arguments.length?i.call(arguments,1):[],n=this,t===void 0)?n._style:_.map(arguments,function(t){return n._style[t]})},r.prototype.setStyles=function(n,t){return t==null&&(t=null),n===void 0?n=this.a.svgStyles.node.populate(this):_.isPlainObject(n)?_.assign(this._style,n):this._style[n]=t,this._setD3Properties(this.a.svgStyles.node.populate(this)),this.a._drawNodes.updateNode(this._d3),this},r.prototype.toggleHidden=function(){var n;return n=this.a,this._state=this._state==="hidden"?"active":"hidden",this.setStyles(),_.each(this._adjacentEdges,function(t){var f,i,e,r,u;return(u=t.id.split("-"),f=u[0],e=u[1],i=n._nodes[""+f]._state,r=n._nodes[""+e]._state,t._state==="hidden"&&i==="active"&&r==="active")?t.toggleHidden():t._state==="active"&&(i==="hidden"||r==="hidden")?t.toggleHidden():void 0})},r.prototype.outDegree=function(){return this._adjacentEdges.length},r.prototype.remove=function(){while(!_.isEmpty(this._adjacentEdges))this._adjacentEdges[0].remove();return delete this.a._nodes[this.id],this.a.vis.select("#node-"+this.id).remove()},r}()};n.prototype.plugins=function(t){return{init:function(){return _.each(_.keys(t.conf.plugins),function(i){return t.plugins[i]=n.prototype.plugins[i](t),t.plugins[i].init!=null?t.plugins[i].init():void 0})}}};n.prototype.themes={"default":{backgroundColour:"#000000",nodeStyle:{all:{radius:function(){return 10},color:function(){return"#68B9FE"},borderColor:function(){return"#127DC1"},borderWidth:function(n,t){return t/3},captionColor:function(){return"#FFFFFF"},captionBackground:function(){return null},captionSize:12,selected:{color:function(){return"#FFFFFF"},borderColor:function(){return"#349FE3"}},highlighted:{color:function(){return"#EEEEFF"}},hidden:{color:function(){return"none"},borderColor:function(){return"none"}}}},edgeStyle:{all:{width:4,color:"#CCC",opacity:.2,directed:!0,curved:!0,selected:{opacity:1},highlighted:{opacity:1},hidden:{opacity:0}}}},white:{theme:"white",backgroundColour:"#FFFFFF",nodeStyle:{all:{radius:function(){return 10},color:function(){return"#68B9FE"},borderColor:function(){return"#127DC1"},borderWidth:function(n,t){return t/3},captionColor:function(){return"#FFFFFF"},captionBackground:function(){return null},captionSize:12,selected:{color:function(){return"#FFFFFF"},borderColor:function(){return"38DD38"}},highlighted:{color:function(){return"#EEEEFF"}},hidden:{color:function(){return"none"},borderColor:function(){return"none"}}}},edgeStyle:{all:{width:4,color:"#333",opacity:.4,directed:!1,curved:!1,selected:{color:"#38DD38",opacity:.9},highlighted:{color:"#383838",opacity:.7},hidden:{opacity:0}}}}};n.prototype.exports=function(n){var t;return t=n,{init:function(){return t.exports.show()},show:function(){return t.dash.select("#all-exports").append("li").attr({"class":"list-group-item active-label toggle"}).html("SVG").on("click",function(){var n,i,r,u,f;return r=d3.select(""+t.conf.divSelector+" svg").node(),i=(new XMLSerializer).serializeToString(r),u="data:image/svg+xml;utf8,"+i,n=u.replace("xlink:",""),f=window.open(n),f.focus()})}}};a=function(){function n(n){this.dataWarning=t(this.dataWarning,this);this.a=n}return n.prototype.dataWarning=function(){return this.a.conf.dataWarning&&typeof this.a.conf.dataWarning=="function"?this.a.conf.dataWarning():this.a.conf.dataWarning==="default"?console.log("No dataSource was loaded"):void 0},n.prototype.divWarning=function(){return"create an element that matches the value for 'divSelector' in your conf.\nFor instance, if you are using the default 'divSelector' conf, simply provide\n<div id='#alchemy'><\/div>."},n}()}).call(this);