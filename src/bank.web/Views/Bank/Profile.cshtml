@using bank.reports
@using bank.enums
@model BankProfileViewModel

@{
    Layout = "~/Views/Shared/_LayoutSidebar.cshtml";
}

@section Header {

    <div class="container-fluid top-row">

        <div class="col-lg-8 push-lg-4 highlights main-column">
            <div class="highlight-item">
                <h1>@Model.Organization.Name</h1>
                <h4 class="chart-title">@Model.PrimaryChart.Name @Model.PrimaryChart.PrimarySeries.Fact.NumericValue.Value.ToAbbreviatedString(false) </h4>
                <div data-chart="primary" data-series="@Model.PrimaryChart.Series.ToJson()" class="main-chart"></div>

                @*<div>begin</div>

                @Html.Partial("_Report", new ReportViewModel { Organization = Model.Organization, Report = Model.PieChartReport })

                <div>end</div>*@

                <div class="row">
                    @foreach (var piechart in Model.PieCharts)
                        {
                        <div class="col-sm-4">
                            <h5>@piechart.Name</h5>

                            <div data-chart="pie"
                                 data-series="@piechart.Series.ToJson()"
                                 class="pie-chart"></div>

                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-4 pull-lg-8 col-xs-12 summary sidebar-column">
            <div class="row p-0 m-0">
                <div class="col-lg-6 p-0 m-0">
                    <div class="summary-item left social-item">
                        @if (!string.IsNullOrWhiteSpace(Model.Organization.Twitter))
                        {
                            <a href="https://twitter.com/@Model.Organization.Twitter">
                                <i class="fa fa-twitter" aria-hidden="true"></i>
                                <span class="tag tag-pill tag-primary">24</span>
                            </a>
                        }
                    </div>
                </div>
                <div class="col-lg-6 p-0 m-0">

                    <div class="summary-item right social-item">
                        @if (!string.IsNullOrWhiteSpace(Model.Organization.Facebook))
                        {
                            <a href="https://www.facebook.com/@Model.Organization.Facebook">
                                <i class="fa fa-facebook" aria-hidden="true"></i>
                                <span class="tag tag-pill tag-primary">8</span>
                            </a>
                        }
                    </div>
                </div>
            </div>
            @*<div class="row p-0 m-0">
                    <div class="col-xs-12">
                        <span class="tag tag-pill tag-primary">231 Branches</span>

                        @Html.Partial("_States")

                    </div>
                </div>*@

            <div class="reports list-group text-xs-left">
                <i class="list-group-item disabled">
                    Reports
                </i>
                <a href="@Request.Url.ToString()/report/call/pres-rc" class="list-group-item">
                    Balance Sheet
                </a>
                <a href="@Request.Url.ToString()/report/call/pres-ri" class="list-group-item">
                    Income Statement
                </a>
                @*<a href="#" class="list-group-item">
                        Profitability
                    </a>*@
                <a href="@Request.Url.ToString()/report/loan-composition" class="list-group-item">
                    Loan Composition
                </a>
                <a href="@Request.Url.ToString()/report/deposit-composition" class="list-group-item">
                    Deposit Composition
                </a>
                <div class="dropdown list-group-item">
                    <a href="#" onclick="return false;" class="dropdown-toggle" id="raw-reports" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Call &amp; UBPR Reports
                    </a>
                    <div class="dropdown-menu" aria-labelledby="raw-reports">
                        @{
                            var isCurrentPeriod = true;
                        }
                        @foreach (var report in Model.Reports)
                        {
                            <div class="dropdown-item">
                                <div class="row">
                                    <div class="col-xs-4">
                                        @report.Period.ToString("yyyy")
                                        @string.Format("Q{0}", report.Period.Quarter())
                                    </div>
                                    <div class="col-xs-4 px-2 text-xs-center">
                                        @if (report.ReportsAvailable.Contains(ReportTypes.Call))
                                        {
                                            <a href="@Url.Url(Model.Organization, report.Period, @ReportTypes.Call.ToString(), "pres-rc", isCurrentPeriod)">
                                                @ReportTypes.Call
                                            </a>
                                        }
                                        else
                                        {
                                            <span>&nbsp;</span>
                                        }
                                    </div>
                                    <div class="col-xs-4 px-2 text-xs-center">
                                        @if (report.ReportsAvailable.Contains(ReportTypes.UBPR))
                                        {
                                            <a href="@Url.Url(Model.Organization, report.Period, @ReportTypes.UBPR.ToString(), "balance-sheet", isCurrentPeriod)">
                                                @ReportTypes.UBPR
                                            </a>
                                        }
                                    </div>
                                </div>
                            </div>

                            isCurrentPeriod = false;

                        }
                    </div>
                </div>
            </div>

            <div class="alerts list-group text-xs-left">
                <a href="#" class="list-group-item disabled">
                    Highlights 2016 Q3
                </a>
                <a href="#" class="list-group-item">
                    <i class="fa fa-arrow-up float-xs-right" aria-hidden="true"></i>
                    Total Assets are up 18%
                </a>
                <a href="#" class="list-group-item">
                    <i class="fa fa-arrow-up float-xs-right" aria-hidden="true"></i>
                    3 new branches since last quarter
                </a>
                <a href="#" class="list-group-item">
                    <i class="fa fa-arrow-down float-xs-right" aria-hidden="true"></i>
                    Peers outpacing growth by 8%
                </a>
            </div>

        </div>

    </div>
}


@section Sidebar {

    <div class="summary">
        <div class="row p-0 mx-2">
            @{
                var counter = 0;
            }
            @foreach (var config in Model.SidebarCharts)
            {
                var noBottomBorder = counter >= Model.SidebarCharts.Count - 2;
                <div class="col-xs-6 p-0">
                    <div class="summary-item @(noBottomBorder ? "no-bottom-border" : "") @(counter++ % 2 == 0 ? "left" : "right")">
                        @if (config.PrimarySeries.Fact != null)
                        {
                            <h3>
                                @config.PrimarySeries.Fact.NumericValue.Value.ToAbbreviatedString(false)
                                <small>
                                    @if (!config.PrimarySeries.Fact.Trend.HasValue)
                                    {

                                    }
                                    else if (config.PrimarySeries.Fact.Trend.Value)
                                    {
                                        <i class="fa fa-arrow-up" aria-hidden="true"></i>
                                    }
                                    else
                                    {
                                        <i class="fa fa-arrow-down" aria-hidden="true"></i>
                                    }
                                </small>
                            </h3>
                            <h6>@config.Name</h6>
                        }
                    </div>
                </div>
            }

        </div>
    </div>


}


<div class="highlights">
    <div class="row mx-0">

        @foreach (var chartConfig in Model.SecondaryCharts)
        {
            <div class="col-md-4 p-0">
                <div class="highlight-item left">
                    <h6>@chartConfig.Name </h6>
                    @if (chartConfig.PrimarySeries.Fact != null)
                    {
                        <h2>@chartConfig.PrimarySeries.Fact.ValueFormatted</h2>
                        <div data-chart="sparkline"
                             data-series="@chartConfig.Series.ToJson()"
                             class="card-sparkline"></div>
                    }
                </div>
            </div>
        }

    </div>

</div>

<div class="card">
    <div class="card-block">
        @Html.Partial("_Report", new ReportViewModel { Report = Model.HighlightTable })
    </div>
</div>

@section StylesheetsProxy {
    <link href="~/assets/css/stately/stately.min.css" rel="stylesheet">

    <style>

        ul.stately {
            background:none;
            width: 200px; /*width and font size must match*/
            font-size: 200px;
            color: #F0F1EE;
        }

        @string.Join(",", Model.States.Select(x=>string.Format("#{0}", x))) {
          color: #2E96EA;
        }

    </style>
}

@section ScriptsProxy {
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="~/assets/scripts/charts.min.js"></script>

    <script>
        $(function () {

            $('[data-chart="primary"]').highcharts('LineChart', {
                plotOptions: {
                    areaspline: {
                        lineWidth: 0,
                        fillColor: {
                            linearGradient: { x1: .2, x2: 0, y1: 0, y2: .75 },

                            stops: [
                                [0, '#2E96EA'],
                                [1, '#30C8CA']
                            ]
                        }
                    }
                }
            });


            $('[data-chart="sparkline"]').each(function () {
                $(this).highcharts('LineChart', {

                });
            });

            $('[data-chart="pie"]').each(function () {
                $(this).highcharts('PieChart', {

                });
            });

            $('[data-chart="sparkline"]').highcharts('LineChart', {

            });



        });
    </script>
}
